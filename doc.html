<html lang="fr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Documentation du script COFantasy2 sous Roll20">
    <meta name="author" content="Ulti">
    <title>Scripts pour Chroniques Oubliées Fantasy 2 sous Roll20</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>

  </head>
  <body data-target="#list" data-spy="scroll" data-offset="10">
    <style>
body{position: relative;}
img{margin: 0 auto; display: block; border-radius: 3px; -webkit-box-shadow: 0px 3px 8px 1px rgba(61, 61, 61,0.40); -moz-box-shadow: 0px 3px 8px 1px rgba(61, 61, 61,0.40); box-shadow: 0px 3px 8px 1px rgba(61, 61, 61,0.4);}
.card, img:hover{-webkit-box-shadow: 0px 3px 8px 1px rgba(61, 61, 61,0.60); -moz-box-shadow: 0px 3px 8px 1px rgba(61, 61, 61,0.60); box-shadow: 0px 3px 8px 1px rgba(61, 61, 61,0.60);}
.card {margin-bottom: 20px;}
.card > img {-webkit-box-shadow: none; -moz-box-shadow: none; box-shadow: none;}
.card.added > img {-webkit-filter: grayscale(100%); -moz-filter: grayscale(100%); -o-filter: grayscale(100%); -ms-filter: grayscale(100%); filter: grayscale(100%); }
.card .card-title {height: 52px; overflow: hidden}
figcaption {font-size: 0.7em; text-align: center; margin-top: -0.7rem; margin-bottom: 0.7rem;}
div.decalage {margin-left: 10px;}
h3.text-info {margin-top: 30px;}
h4.text-secondary {margin-top: 30px;}
.content li {margin-top: 10px}
div.decalage > h3.text-info:first-child, div.decalage > h4.text-secondary:first-child, .content li:first-child {margin-top: 0px;}
div.alert > p:last-child {margin-bottom: 0}
#json_data textarea {margin-bottom: 10px;}
#json_data button {margin-bottom: 10px; margin-right: 5px; float: right;}
#json_data button::after {clear: both;}
table {border-collapse: collapse;}
th, td {padding: 5px;}
tr {line-height: 25px;}
    </style>
    <script>
      $('document').ready(function() {      
        $(document).on('click', '[data-href]', function(){
          window.open($(this).data('href'));
        });

        $('a[href^="http://"], a[href^="https://"]').attr('target','_blank');

        $('div.sticky-top ul.collapse').on('show.bs.collapse', function () {
          $('div.sticky-top ul.collapse').collapse('hide');
        });
      });
    </script>
    <div class="container-fluid">
      <div class="row">
        <div class="col-md-3 col-sm-4 d-none d-sm-block d-md-block d-lg-block d-xl-block">
          <div class="sticky-top">
            <h1>Sommaire</h1>
            <ol>
              <li data-toggle="collapse" data-target="#how_to_use"><a href="#comment_utiliser_script">Comment utiliser Le script</a></li>
              <ul id="how_to_use" class="collapse">
                <li><a class="text-info" href="#token_personnages">Tokens et personnages</a></li>
                <li><a class="text-info" href="#commandes">Les commandes</a></li>
                <li><a class="text-info" href="#macros_abilities">Macros, abilities et listes d'actions</a></li>
                <li><a class="text-info" href="#predicats">Prédicats</a></li>
                <li><a class="text-info" href="#methode_selection_groupes">Méthodes de sélection de groupes</a></li>
                <li><a class="text-info" href="#gestion_temps">Gestion du temps (rounds, repos, ...)</a></li>
                <li><a class="text-info" href="#equipement">Équipement</a></li>
              </ul>
              <li data-toggle="collapse" data-target="#main_action"><a href="#action_principales">Actions principales</a></li>
              <ul id="main_action" class="collapse">
                <li><a class="text-info" href="#jet_caracteristiques">Jet de caractéristiques</a></li>
                <li><a class="text-info" href="#attaques">Les attaques</a></li>
                <li><a class="text-info" href="#dm_et_soins">Dégâts et soins</a></li>
                <li><a class="text-info" href="#statut_etats">Statut et états</a></li>
                <li><a class="text-info" href="#sorts">Sorts</a></li>
                <li><a class="text-info" href="#deplacements">Déplacements</a></li>
                <li><a class="text-info" href="#lumiere">Lumière</a></li>
                <li><a class="text-info" href="#anonymat">Anonymat et fausses identités</a></li>
                <li><a class="text-info" href="#autre">Autres aspects du jeu</a></li>
              </ul>
              <li data-toggle="collapse" data-target="#peuples"><a href="#VoiesPeuples">Voies de peuples</a></li>
              <ul id="peuples" class="collapse">
                <li><a class="text-info" href="#demi-orc">Demi-orc</a></li>
                <li><a class="text-info" href="#elfe-haut">Elfe haut</a></li>
                <li><a class="text-info" href="#elfe-sylvain">Elfe sylvain</a></li>
                <li><a class="text-info" href="#gnome">Gnome</a></li>
                <li><a class="text-info" href="#halfelin">Halfelin</a></li>
                <li><a class="text-info" href="#humain">Humain</a></li>
                <li><a class="text-info" href="#mage">Mage</a></li>
                <li><a class="text-info" href="#nain">Nain</a></li>
              </ul>
              <li data-toggle="collapse" data-target="#profils"><a href="#VoiesProfils">Voies de profils</a></li>
              <ul id="profils" class="collapse">
                <li><a class="text-info" href="#arquebusier">Arquebusier</a></li>
                <li><a class="text-info" href="#barbare">Barbare</a></li>
                <li><a class="text-info" href="#barde">Barde</a></li>
                <li><a class="text-info" href="#chevalier">Chevalier</a></li>
                <li><a class="text-info" href="#druide">Druide</a></li>
                <li><a class="text-info" href="#ensorceleur">Ensorceleur</a></li>
                <li><a class="text-info" href="#forgesort">Forgesort</a></li>
                <li><a class="text-info" href="#guerrier">Guerrier</a></li>
                <li><a class="text-info" href="#magicien">Magicien</a></li>
                <li><a class="text-info" href="#moine">Moine</a></li>
                <li><a class="text-info" href="#pretre">Prêtre</a></li>
                <li><a class="text-info" href="#rodeur">Rôdeur</a></li>
                <li><a class="text-info" href="#sorcier">Sorcier</a></li>
                <li><a class="text-info" href="#voleur">Voleur</a></li>
              </ul>
              <li data-toggle="collapse" data-target="#prestige"><a href="#VoiesPrestige">Voies de prestige</a></li>
              <ul id="profils" class="collapse">
              </ul>
              <li data-toggle="collapse" data-target="#autres_capacites"><a href="#Autres_capacités">Autres capacités</a></li>
              <ul id="autres_capacites" class="collapse">
              </ul>
              <li data-toggle="collapse" data-target="#markers_personnalises"><a href="#Markers_personnalisés">Markers personnalisés</a></li>
              <ul id="markers_personnalises" class="collapse">
                <li><a class="text-info" href="#Markers_presentation">Présentation</a></li>
                <li><a class="text-info" href="#Markers_COF">Markers COF</a></li>
                <li><a class="text-info" href="#Markers_Import">Importation dans Roll20</a></li>
                <li><a class="text-info" href="#Markers_Check">Activation et Vérification</a></li>
              </ul>
              <li data-toggle="collapse" data-target="#console"><a href="#Console">Console API</a></li>
              <ul id="console" class="collapse">
                <li><a class="text-info" href="#Generalites_Console">Généralités sur la Console API</a></li>
                <li><a class="text-info" href="#Erreurs_Console">Principaux messages d'erreur</a></li>
                <li><a class="text-info" href="#Infos_Console">Principaux messages d'information</a></li>
                <li><a class="text-info" href="#Reset_state">Purger les variables d'état du jeu</a></li>
              </ul>
              <li><a href="#index_predicats">Index des prédicats</a></li>
              <li><a href="#index_effets">Index des effets</a></li>
            </ol>
          </div>
        </div>
        <div class="col-md-9 col-sm-8 content">
          <h1>Documentation pour la version 1.00 de COFantasy2</h1>
          <h2 class="text-primary" id="comment_utiliser_script">1. Comment utiliser Le script</h2>
          <div class="decalage">
              <p>Ce script a été écrit pour fonctionner avec la fiche de personnages développée par <a href="https://github.com/Roll20/roll20-character-sheets/tree/master/ChroniquesOublieesFantasy2">StéphaneD</a> (<a href="https://stephaned68.github.io/COF2e/">documentation de la fiche</a>).</p>
              <p><img class="img-fluid" width=311 src="images/choix_fiche.png" ></p>
              <figcaption>À choisir pendant la création de la partie sur Roll20.</figcaption>
            <h3 class="text-info" id="token_personnages">1.1 Tokens et personnages</h3>
            <div class="decalage">
            <p>Chaque token avec lequel vous souhaitez interagir doit représenter un personnage.</p>
            <p>La barre 1 représente toujours les points de vie du token.<br />
            La barre 2 représente les points de mana.<br />
            La barre 3 est utilisée pour donner un modificateur temporaire à l’attaque du token.<br />
            La barre 4 est utilisée pour les dégâts temporaires (penser à activer son affichage). Elle est vide la plupart du temps, pour ne pas prendre trop de place.
            </p>
            <p>Il est possible de mettre automatiquement les bonnes valeurs sur le token par défaut en utilisant la commande <code>!cof2-link-token</code>. Cela peut se faireen sélectionnant un token sur la carte, mais il faut alors que le token représente la fiche, ou au moins qu'il ait le même nom. En utilisant <code>!cof2-link-token --selectChar @{<i>nom</i>|character_id}</code>, où <i>nom</i> est le nom de la fiche, on peut mettre tout à jour sans avir de token sur la carte : il suffit d'avoir mis une image de token sur la fiche. Il faut malgré tout que le script puisse utiliser l'image, c'est-à-dire que l'image doit être dans une bibliothèque personnelle, ça ne peut pas être une image directement prise du marketplace. Dans ce cas, il faut impérativement mettre le token sur la carte.</p>
            <p>Les statuts des tokens sont en partie utilisés pour représenter des états. Voir plus loin pour la <a href="#etats">liste des statuts</a> utilisés par le script. Pour tenir compte d'autre états non visibles sur les tokens, le script utilise des attributs supplémentaires (hors fiche).
            </p>
            <p>Certains messages tiennent compte du genre (masculin ou féminin) des personnages. Ils utilisent le champ <code>Genre</code> de la fiche de personnage. Un personnage est reconnu comme féminin si ce champ commence par la lettre <code>F</code>.</p>
            <h4 id="mooks">Les mooks et la numérotation des tokens</h4>
            <p>Il est important de noter la différence entre les tokens liés à un personnage (la barre 1 est liée aux points de vie du personnage, tout changement sur la fiche se répercute sur le token), et les tokens non liés (dans ce cas, la fiche de personnage est générique, et chaque token est une instance différente, avec des PV indépendants). Dans Roll20, ces tokens non liés sont appelés des <strong>mooks</strong>.</p>
            <p>Pour gérer les états spécifiques à un mook, le script utilise des conventions de nom d'attribut utilisant le nom du token. Pour que cela fonctionne correctement, <b>il est important que deux tokens indépendants ne portent pas le même nom</b>, même s'ils représentent le même personnage. Pour cette raison, le script va automatiquement renommer les tokens indépendants, en leur associant un numéro. Il est toujours possible de remodifier le nom après la création du token, mais dans ce cas, c'est vous qui gérez...</p>
            </div>
            <h3 class="text-info" id="commandes">1.2 Les commandes</h3>
            <div class="decalage">
              <p>La façon la plus simple d'interragir avec le script est de taper des commandes dans le <i>chat</i> de Roll20. Les commandes pour ce script commencent toujours par <code>!cof2-</code> et contiennent tout ce qui est écrit jusqu'à ce qu'on presse sur entrée. Si on utilise une commande du script dans une macro, cela signifie qu'il de faut pas de retour à la ligne. Le premier mot de la ligne est l'action. Il est ensuite suivi d'un ou plusieurs blancs qui sont les arguments de l'action, par exemple, pour <code>!cof2-centrer-sur-token</code>, il n'y aura qu'un argument, le nom du token. Les arguments sont séparés entre eux de 1 ou plusieurs blancs.<p>
              <p>La plupart des actions acceptent aussi des options, qui ont toutes la même forme : elles commencent par <code> --</code> directement suivi (sans blanc) du nom de l'option, puis de ses paramètres séparés par des blancs.</p>
            </div>
            <h3 class="text-info" id="macros_abilities">1.3 Macros, abilities et listes d'actions</h3>
            <div class="decalage">
              <p>Comme tous les scripts, ce script est utilisable tel quel dans le chat, mais il est pensé pour être utilisés par des macros qui permettent un autre niveau d'automatisation parfois difficile d'accès au sein des scripts. le script génère d'ailleurs la plupart des macros utiles à la première utilisation, et il met automatiquement les macros à jour à chaque changement de version. Il est possible de demander des les re-créer en tapant la commande <code>!cof2-set-macros</code> dans le chat.</p>
              <p>
              Le script ne peut pas mettre les macros dans la barre de raccourci. Je recommande que chaque joueur se crée sa macro <code>Centrer</code>, contenant le code <code>!cof2-centrer-sur-token <i>nom_de_leur_token_principal</i></code>, qui leur permettra en un click de centrer la vue de la carte sur leur token. Pour le MJ, le script suggère de mettre un certain nombre des macros qu'il crée, au moment de la première utilisation.</p>
              <h4 class="text-secondary" id="listes_action" >Listes d'actions</h4>
              <div class="decalage">
                <p>Les listes d'action, présentes dans l'onglet <code>SCRIPT</code> de la fiche, sont une façon de regrouper et d'afficher des commandes pour COF2. Elles peuvent donc se substituer aux macros ou aux abilities, mais avec des restrictions. L'architecture des listes dans les fiches Roll20 ne permet pas vraiment d'avoir un nombre quelconque de liste : pour l'instant, la fiche en propose 5. La première liste d'action est particulière, car elle est utilisée pour les actions à proposer à chaque fois que c'est le tour du personnage quand <a href="#round_par_round">le temps est découpé en rounds</a>. Chaque liste d'action possède un titre, et vous pouvez modifier les titres de listes 2 à 5. Pour faire afficher une liste d'actions, on peut utiliser la commande <code>!cof2-liste-actions <i>titre</i></code> en sélectionnant un personnage. Sans argument, cela va afficher la première liste, sinon cela affiche la liste de titre <i>titre</i>. On ne peut utiliser les action d'une liste d'action qu'en affichant celles-ci dans le chat.
                </p>
                <p>Chaque action de la liste se compose d'un nom d'action, d'un type d'action (pour les actions limitées, d'attaque ou de mouvement) et d'une commande. Enfin, une case peut être décochée pour déactiver temporairement l'affichage de l'action. Le nom de l'action peut soit être directement une commande (commençant par <code>%</code>, <code>#</code> ou <code>!</code>), et dans ce cas l'action affichée sera déterminée par le script, soit du texte qui sera affiché tel quel. Dans ce cas, il sera souvent nécessaire de préciser le code de l'action dans le champ <i>Commande de script</i>. La commande peut être un text contenant des macros et des abilities. Si après expansion des macros et abilities, elle commence par un <code>!</code>, elle sera exécutée telle quelle quand on cliquera sur le bouton dans le chat. Sinon, le script exécutera la commande <code>!cof2-action </code> suivi du texte du code. Si la commande comporte des retours à la ligne, chaque ligne est interprétée, puis passée en argument à <code>!cof2-multi-command</code>. N'oubliez pas que vous pouvez faire afficher une autre liste en utilisant la commande <code>!cof2-liste-actions</code>, ça peut être utile pour afficher une liste moins longue et regrouper certaines actions de manière logique (par exemple mettre tous les sorts dans une liste dédiée).
                <p>Il existe un certain nombre de commandes spéciales, qui peuvent être rentrée dans le titre ou le code : 
                <ul>
                  <li><code>!attaques</code> fera afficher toutes les attaques cochées de la fiche</li>
                  <li><code>!arme-en-main</code> affichera l'attaque correspondant à l'arme en main, ou si aucune arme n'est en main, une attaque naturelle non cochée, et si il n'y en a pas non plus, une attaque à mains nues. Vous pouvez faire suivre cette commandes d'options d'attaque, comme <code>--deBonus</code>.</li>
                  <li><code>!options</code> passera en option à toutes les actions suivantes tout ce que vous écrirez dans la même ligne.</li>
                </ul>
                </p>
              </div>
            <h3 class="text-info" id="predicats">1.4 Prédicats</h3>
            <div class="decalage">
              <p>Une façon courante d'informer le script qu'un personnage dispose d'une capacité particulière (que ce soit dû à son entraînement, à un objet porté, ou l'utilisation de règles particulières par le MJ) consiste à utiliser des prédicats. Il s'agit de mots clés à rentrer dans des zones de texte dédiées de la fiche, comme par exemple la zone <code>Prédicats</code>, visible depuis l'onglet <code>Script</code>. Ces mots clés peuvent être séparés de blancs ou de retours à la ligne.</p>
              <p>On peut associer une valeur à un prédicat (le plus souvent un nombre, mais en fait n'importe quel mot qui ne contienne ni virgule, ni blanc, ni <code>:</code>). Pour cela, faire suivre le prédicat de <code>:</code> puis de la valeur. Si vous avez besoin des virgules, blanc ou <code>:</code> dans les valeurs d'un prédicat, vous pouvez tout mettre entre <code>"</code>. Il faut juste faire attention au fait que les caractères <code>\</code> sont alors interprétés comme une façon d'utiliser le caractère suivant. Par exemple, pour un prédicat <code>compagnon</code>, de valeur <code>chaton / "tigre"</code>, il faudra écrire <code>compagnon: "chaton / \"tigre\""</code>.</p>
              <p>Dans chaque ligne de la zone de prédicats, tout ce qui vient après <code>//</code> est considéré comme du commentaire et ignoré.</p>
              <p>Les prédicats à valeur numériques ne se cumulent pas au sein d'une même zone de texte : le script prend la plus grande valeur, si le prédicat apparaît plusieurs fois. Pour les autres prédicats, en général, l'ensemble des prédicats est pris comme un seul prédicat, si cela est possible. Sinon, un seul prédicat est utilisé, les autres sont ignorés.</p>
              <p>Le script va automatiquement inférer un certain nombre de prédicats selon les capacités possédées par le personnage. Pour afficher les prédicats actif d'un personnage, vous pouvez utiliser <code>!cof2-log-preds</code>.</p>
            </div>
            <h3 class="text-info" id="methode_selection_groupes">1.5 Méthodes de sélection de groupes</h3>
            <div class="decalage">
              <p>Comme les joueurs ne peuvent pas sélectionner un nombre arbitraire d'ennemis, le script propose différentes options (à ajouter aux commandes) pour sélectionner des cibles&nbsp;:</p>
              <ul>
                <li>option <code>--cible <i>tid</i></code> : pour ajouter la cible ayant l'id de token <i>tid</i>. Par exemple, pour faire choisir une cible par le joueur, on peut utiliser l'option <code>--cible @{target|token_id}</code>.</li>
                <li>option <code>--enVue</code> : sélectionne tous les tokens en vue des personnages déjà sélectionnés. Accepte aussi un argument d'id de token, dans ce cas on ne garde que les tokens en vue de celui avec cette id.</li>
                <li>option <code>--disque</code> : le premier argument, optionnel, est l'id ou le nom d'un token qui représente un personnage, le deuxième argument un rayon. Cela sélectionne tous les tokens à une distance de moins que le rayon du premier argument (ou du personnage à l'origine de l'effet, si le premier argument est absent). Si un troisième argument est donné, il est interprété comme la portée maximum entre le centre du disque et le token du personnage à l'origine de l'effet. Si le premier argument représente un personnage avec un max de PV à 0, il est compris comme un personnage fictif créé juste pour définir le disque, et il sera supprimé après la sélection. À noter que le script crée par défaut un tel personnage, utilisable par tous, et appelé <code>Cible</code>.</li>
                <li>option <code>--disquePasseMur</code> : comme <code>--disque</code>, mais l'effet traverse les murs.</li>
                <li>option <code>--equipe <i>nom</i></code> : agit sur tous les personnages mentionnés dans l'<a href="#equipes">équipe</a> nommée <i>nom</i>.</li>
                <li id="allie">option <code>--allies</code> : sélectionne tous les personnages qui sont dans des <a href="#equipes">équipes d'alliés</a> communes avec un des personnages déjà sélectionnés. Optionellement, on peut préciser une id de token dont on doit sélectionner les alliés.</li>
                <li>option <code>--alliesEnVue</code> : comme <code>--allies</code>, mais ne garde que les alliés en vue (en fonction des murs sur le layer lumière).</li>
                <li>option <code>--saufAllies</code> permet d'exclure les alliés de la sélection (voir plus haut pour la définition des alliés), ou du token mis en argument.</li>
                <li>option <code>--touteLaPage</code> sélectionne tous les tokens sur le layer token de la page.</li>
                <li>option <code>--toutLeJeu</code> sélectionne tous les tokens du jeu.</li>
              </ul>
              <p>Attention, on ne peut sélectionner que des tokens sur une même page.</p>
              <h4 id="equipes">Les équipes et les alliés</h4>
              <p> Une équipe, pour le script, est simplement un ensemble de personnages. À noter que tous les <a href="mooks">mooks</a> d'une fiche donnée appartiennent forcément aux même équipes. L'usage principal des équipes est de faciliter les sélections (en utilisant l'option <code>--equipe</code>) et de définir les alliés des personnages.</p>
              <p>Le script crée toujours au moins une équipe pour les joueurs (les personnages ayant une fiche de PJ et contrôlé par au moins un joueur, qui peut être le MJ). Par défaut, cette équipe est considérée alliée, mais cela peut être changé.</p>
              <p>Pour lister et gérer les équipes, vous pouvez utiliser la commande <code>!cof2-lister-equipes</code>. Si des personnages sont sélectionnés quand la commande est lancée, elle ne va afficher que les équipes auquelles tous les personnages sélectionnés appartiennent.
              </p>
              <p>Il est aussi possible de créer une équipe alliée rapidement en sélectionnant des tokens et en tapant <code>!cof2-allier</code>. En utilisant les options de sélection, il est facile de faire une équipes qui réunit toute les équipes des tokens sélectionnés.</p>
            </div>
            <h3 class="text-info" id="gestion_temps">1.6 Gestion du temps </h3>
            <div class="decalage">
              <p>COF2 formalise principalement deux échelles de temps : soit le temps compté round par round de 6 secondes (principalement pour le combat), soit le temps compté en fonction des repos courts et des repos longs. Le reste n'a pas d'impact sur les mécaniques de jeu. Le script ne garde donc que ces deux aspects, et vous devrez gérer le reste tout seuls.</p>
              <h4 class="text-secondary" id="round_par_round">Le temps au round par round</h4>
              <div class="decalage">
                <p>Dans le temps au round par round, les personnages agissent par ordre d'initiative. La façon la plus courante de passer dans ce mode, est donc d'utiliser la commande <code>!cof2-init</code> en sélectionnant les tokens qui vont participer à l'action. Cela fera apparaître le turn tracker de Roll20, avec les personnages triés. Le script affiche une liste d'actions possibles dans le tour pour le joueur qui contrôle le personnage dont c'est le tour de jouer. Il suffit de cliquer sur le bouton tour suivant du turn tracker pour passer au personnage suivant. Les tokens ayant un <a href=#predicats>prédicat</a> <code>aucuneActionCombat</code> ne sont jamais ajoutés au turn tracker.</p>
                <p>À chaque instant, le token dont c'est le tour d'agir est signalé par une aura qui bouge lentement. L'image de cette aura peut être modifiée dans les options (<code>!cof2-options images</code>), et il est possible de spécifier une aura pour chaque token, en ajoutant une ligne dans le champ <code>GM Notes</code> du token (en bas de la partie basique de l'édition du token). Cette ligne doit commencer par <code>init_aura:</code>, et contenir une <a href=https://wiki.roll20.net/API:Objects#imgsrc_and_avatar_property_restrictions>url valide pour un token</a>. N'oubliez pas de sauvegarder le token comme token par défaut pour un personnage si vous voulez que ce personnage ait toujours cette aura. Le token dont c'est le tour est mis au premier plan, sauf si son personnage a un prédicat <code>tokenEnDessous</code>, ce qui peut parfois être plus pratique pour les très gros tokens.</p>
                <p>Le script garde le compte des actions effectuées à travers les commandes ayant l'option <code>typeAction</code>, suivie du code de l'action:
                <ul>
                  <li><strong>L</strong>: action limitée,</li>
                  <li><strong>A</strong>: action d'attaque,</li>
                  <li><strong>M</strong>: action de mouvement,</li>
                  <li><strong>G</strong>: action gratuite (qui nécessite d'être conscient).</li>
                </ul>
                Si un personnage essaie de faire une action qui n'est plus possible (une deuxième action limitée, par exemple), le script va afficher un bouton pour le MJ pour autoriser l'action. Si une action ne demande pas d'utiliser le script, mais que vous voulez quand même la signaler script, utilisez la commande <code>!cof2-action</code>, avec un petit texte explicatif. Par exemple <code>!cof2-action ouvre la porte --typeAction M</code>.
                </p>
                <p>Par défaut, les tokens dont ce n'est pas le tour ne peuvent pas être déplacés par les joueurs. La liste des actions qui apparaissent au tour d'un personnage contient une action permettant de bouger ce personnage d'une distance maximale de 10 m (valeur qui peut être changée sur la fiche). Les autres actions affichées dépendent des attaques de la fiche, des capacités cochées sur la fiche, et de la liste d'actions de l'onglet <code>SCRIPT</code>. Cette <a href="#listes_action">liste d'actions personnalisable</a> permet de proposer des actions qui diffèrent des règles normales, ou qui ne sont pas encore gérées par le script.</p>
                <p>Normalement, le script affiche au joueur une liste d'actions actualisée après chaque action limitée, d'attaque ou de mouvement, mais si le joueur a besoin de réafficher cette liste, il peut selectionner son token, et cliquer sur le bouton <code>A&#x2A67;</code>. Le MJ peut à tout moment faire passer au personnage suivant dans le turn tracker, et le script proposera au joueur de finir son tour quand il n'aura plus d'action à faire. Si vous en avez besoin, vous pouvez aussi lui faire utiliser la commande <code>!cof2-tour-suivant</code>.
                </p>
                <p>Pour mettre fin à la gestion du temps au tour par tour, le script fournit une macro <code>Fin-combat</code>. Cette macro appelle en interne la commande <code>!cof2-fin-combat</code>.</p>
              </div>
              <h4 class="text-secondary">Les durées en minutes</h4>
              <div class="decalage">
                <p>Pour les effets à durée en minutes, on peut préciser la durée avec une option <code>--dureeEnMinutes</code>, suivi de la durée (entière). Le script fait passer une minute tous les 10 tours en combat, et une minute à la fin du combat, pour arrondir. Vous pouvez encore avancer le temps avec la commance <code>!cof2-passer-minutes</code>.</p>
              </div>
              <h4 class="text-secondary">Les repos</h4>
              <div class="decalage">
                <p>Pour faire passer un récupération rapide à un personnage, utilisez <code>!cof2-recuperation rapide</code>. Si le personnage a encore des DR, cela lui affichera un bouton pour en depenser un.</p>
                <p>Pour une récupération complète, utilisez <code>!cof2-recuperation complet </code>, auquel vous pouvez ajouter un nombre positif pour faire jeter des jets de CON avec cette difficulté. Les personnages qui ont des DR pourront choisir d'en dépenser un.</p>
              </div>
            </div>
            <h3 class="text-info" id="equipement">1.7 Équipement </h3>
            <div class="decalage">
              <h4 class="text-secondary" id="degainer">Dégainer une arme : <code>!cof2-degainer <i>N</i></code></h4>
              <div class="decalage">
                <p>Ce que le personnage porte en main est visible sur la fiche, dans l'onglet <code>ATTRIBUTS</code>, sous-onglet <code>EN MAIN</code>. Le script utilise cette information, par exemple pour les <a href="#attaques">attaques</a> utilisant l'arme en main, ou pour des capacités comme <strong>Plus vite que son ombre</strong>. Pour faciliter la gestion des armes en main, le script propose plusieurs mécanismes&nbsp;:
                <ul>
                  <li><code>!cof2-degainer <i>L</i></code> où <i>L</i> est le label d'une des attaques sur la fiche de personnage : cela fait rengainer l'arme en main et dégainer l'arme correspondant à cette attaque. Si le label ne correspond à aucune attaque (ou qu'on ne donne pas de label), l'action fait rengainer l'arme en main. On peut donner en argument 2 labels d'armes, pour faire dégainer à la fois une arme dans la main dominante (le premier label) et une arme dans l'autre main. <code>!cof2-degainer <i>l</i> gauche</code> permet de dégainer (ou rengainer) uniquement une arme dans l'autre main. L'ordre de rengainer sans argument <code>gauche</code> ou <code>droite</code> fait rengainer les deux armes (si le personnage en porte deux). À noter que le script utilise les notions de main droite et de main gauche dans un soucis de simplification. Un personnage gaucher pourra utiliser les termes <code>dominant</code> ou <code>faible</code> s'il préfère. L'intérêt principal de cette commande, c'est qu'on peut lui donner en argument un <code>--typeAction</code> pour utiliser une action de mouvement ou d'attaque.</li>
                  <li>Si on attaque avec <code>!cof2-attaque <i>tok1 tok2 L</i></code>, et que l'attaque est de type <code>Arme en main</code>, alors on considère qu'on doit dégainer cette arme pour pouvoir l'utiliser. Le script envoie le message et considère ensuite l'arme comme étant en main, au MJ de vérifier que le joueur dispose bien d'une action de mouvement pour le faire.</li>
                  <li>Enfin, en fin de combat, si le personnage possède un prédicat <code>armeParDefaut</code>, le script va lui faire dégainer l'arme dont le label est la valeur du prédicat. Donc si le prédicat n'a pas de label associé, le personnage va rengainer son arme.</li>
                </ul>
                <p>Dans tous les cas, si le personnage dégaine une arme à 2 mains, le script fait enlever le bouclier.</p>
              </div>
              <h4 class="text-secondary" >Objets magiques</h4>
              <div class="decalage">
                <i>En attente d''un champ sur la fiche.</i>
              </div>
              <h4 class="text-secondary" id="consommables">Utilisation des ressources (potions, parchemins, ...) <code>!cof2-lister-ressources</code></h4>
              <div class="decalage">
                <p>Cette fonction affiche la liste des ressources de la fiche (onglet "Équipement"), avec la possibilité de cliquer sur un élément de la liste pour l'utiliser (et activer son effet) ou l'échanger avec un autre personnage (via le symbole d'échange).</p>
                <p>Pour l'instant, seules les commandes <code>!cof2-effet</code>, <code>!cof2-attaque</code>, <code>!cof2-action</code> et <code>!cof2-soin</code> diminuent correctement le nombre de consommables.</p>
                <div class="alert alert-warning">
                  <p><strong>Attention : </strong></p>
                  <ul>
                    <li>Pour la commande <code>!cof2-attaque</code>, il est vivemement recommandé de ne pas utiliser de label, mais uniquement un nom et des options si vous voulez faciliter l'échange du consommable.</li>
                    <li>De manière générale, faites attention avec les références utilisé dans le consommable du personnage qui utilise le consommable.<br />
                    </li>
                  </ul>
                </div>
                <p>L'échange via le symbole <span class="text-danger"><strong>&#8596;</strong></span> vous permettra de sélectionner un token destinataire qui recevra le consommable dans sa liste. Si le consommable existe déjà pour le destinataire, sa quantité sera augmenté de 1, sinon le consommable sera créé.</p>
                <div class="alert alert-secondary">
                  <p>Cette fonction peut-être très utile pour que les PJ échangent entre eux un consommable, mais aussi pour faciliter la vente d'objet entre PNJ et PJ.</p>
                  <p>Pour cette dernière, il vous suffira de préparer un personnage avec un token qui contient, dans son équipement, les consommables à échanger/vendre.</p>
                </div>
              </div>
            </div>
          <h2 class="text-primary" id="action_principales">2. Actions principales</h2>
          <p>Pour la plupart des actions ci-dessous, il est généralement utile de créer des macros facilitant leur utilisation. Pour mettre en place un jeu de macros par défaut, vous pouvez taper <code>!cof2-set-macros</code> dans le chat. Si vous souhaitez redéfinir des macros existantes, vous pouvez taper <code>!cof2-set-macros --force</code>.</p>
          <div class="decalage">
              <h3 class="text-info" id="jet_caracteristiques">2.1 Les jets de caractéristiques</h3>
              <div class="decalage">
                <p><code>!cof2-jet <i>carac</i></code> : fait un simple jet pour la caractérisique sélectionnée.</p>
                <p>Si on ne donne aucun argument (en dehors des options), la commande demande de préciser la caractéristique à tester. Cliquer sur une caractéristique propose au joueur de choisir un bonus évolutifs, de peuple et de voie de prestige (s'il en a) adaptés au test. De plus, s'il existe un handout nommé <code>Compétences</code>, celui-ci sera aussi utilisé pour proposer pour chaque caractéristique un choix de compétences à tester. Le handout doit contenir dans ses notes des lignes commençant par une caractéristique (FOR, AGI, ...), suivi de <code>:</code>, puis des noms de compétences, séparés par des blancs, des retours à la ligne, des virgules ou des <code>/</code>.</p>
                <p>La commande accepte les arguments suivants:</p>
                <ul>
                  <li><code>--difficulte <i>i</i></code> la difficulté du test
                    <li><code>--bonus <i>b</i></code> pour spécifier un bonus numérique <i>bi</i> au jet.</li>
                    <li><code>--bonusEvolutif <i>b</i></code> pour un bonus évolutif. <i>b</i> peut soit être un nombre, soit un nom de bonus évolutif.</li>
                    <li><code>--bonusPeuple <i>b</i></code> pour un bonus de voie de peuple. <i>b</i> peut soit être un nombre, soit un nom de bonus de peuple.</li>
                    <li><code>--bonusPrestige <i>b</i></code> pour un bonus de voie de prestige. <i>b</i> peut soit être un nombre, soit un nom de bonus de voie de prestige.</li>
                  <li><code>--deBonus</code> lance le jet avec un dé bonus.</li>
                  <li><code>--deMalus</code> lance le jet avec un dé malus.</li>
                  <li><code>--predicat</code> pour spécifier un prédicat dont la valeur doit être ajoutée au jet. Il est possible de spécifier plusieurs prédicats.</li>
                  <li><code>--attribut</code> pour spécifier un attribut dont la valeur doit être ajoutée au jet. C'est pratique, par exemple pour avoir un bonus temporaire générique.</li>
                  <li><code>--competence</code> précise le nom du jet à afficher. De plus, cela va aussi faire rechercher une compétence de même nom (sans tenir compte des majuscules) pour une fiche de PJ et un attribut ou un prédicat pour une fiche de PNJ. Par exemple <code>!cof2-jet AGI --competence Discrétion</code> va lancer un jet d'agilité, qui sera affiché comme un jet de Discrétion, et qui va ajouter au jet le bonus d'une compétence discrétion ou d'un éventuel prédicat <code>discrétion</code>.</li>
                  <li><code>--secret</code> : le jet n'est visible que par les personnes qui contrôlent le personnage, plus le MJ. Si la personne qui a lancé la commande est MJ, il sera le seul à voir le résultat.</li>
                  <li><code>--listeCompetences</code> : si la commande n'a pas déjà d'option <code>--competence</code>, invite l'utilisateur à choisir une compétence parmis une liste correspondant à la caractéristique (incluant celles provenant du handout <code>Compétences</code> tel que défini plus haut).</li>
                  <li><code>--plageEchecCritique <i>c</i></code> : permet de considérer tout jet de dé inférieur ou égal à <i>c</i> comme un échec critique.</li>
                  <li><code>--succes <i>message</i></code> : affiche <i>message</i> en cas de succès au jet. N'a pas d'effet si la difficulté du jet n'est pas définie.</li>
                </ul>
                <p>Si le personnage possède un attribut numérique <code>modificateurTests</code>, ce modificateur sera pris en compte pour tous les tests.</p>
                <p>Dans les options de jeu (affichés en utilisant <code>!cof2-options</code>, dans le menu des options d'affichage, il est possible de choisir de ne faire afficher les résultats qu'au MJ, qui peut alors en cliquant sur un bouton le montrer aux joueurs (ou pas).</p>
                <p>Enfin, il est possible de faire lancer des jets de chance avec <code>!cof2-jet-chance</code>. Si plusieurs tokens sont selectionnés, le script triera les jets de chance par ordre croissant.</p>
              </div>
            <h3 class="text-info" id="attaques">2.2 Les attaques</h3>
            <div class="decalage">
              <code>!cof2-attaque @{selected|token_id} @{target|token_id} <i>n</i></code></h4>
                <p>où <i>n</i> est un argument optionnel qui peut soit correspondre au label de l'attaque sur la fiche du personnage (ce label est automatiquement généré par la fiche et affiché juste devant le nom), soit être le nom de l'attaque. Si cet argument est <code>-1</code>, le script cherchera si le personnage a une arme en main et utilisera cette arme. Si c'est <code>-2</code>, il va chercher l'arme en main gauche. Si cet argument est absent ou qu'il ne correspond pas à un label de la fiche du personnage, l'attaque aura les valeurs par défaut d'une attaque au contact infligeant 1d4 DM. Pour plus de facilité, vous pouvez utiliser la macro <code>Attaque</code> qui fait <code>!cof2-attaque @{selected|token_id} @{target|token_id}</code></p>
                <div class="alert alert-success" role="alert">
                  <p>Exemple avec label :</p>
                  <div class="decalage">
                    <code>!cof2-attaque @{selected|token_id} @{target|token_id} 1</code>
                  </div>
                </div>
                <p>L'attaque tient alors compte de toutes les informations sur la fiche. La plupart d'entres elles sont expliquées dans la <a href="https://stephaned68.github.io/COF2e/">documentation de la fiche</a>, mais celles apparaissant sur la seconde ligne ont une utilité particulière pour le script. Les modificateurs sont constitués d'options sans argument, séparées par une espace et/ou une virgule. Les options sont reprises telles quels comme un argument à l'attaque (voir plus bas pour le liste de ces options). Attention, pour l'instant ne traite correctment les jets (parties entre crochets) et les demandes au joueur (de type <code>?{question?}</code>) que si on passe par une liste d'actions (donc pas directement en faisant <code>#Attaque 1</code> dans le chat). Une troisième ligne peut aussi s'afficher, pour gérer le nombre d'armes de jet, ou pour les armes portées, pour indiquer des <a href=#predicats>prédicats</a> actifs seulement quand on porte l'arme. Il est possible de spécifier une arme batarde (pouvant se porter à une ou deux mains) en renseignant un prédicat <code>batarde</code> de valeur le dé de DM à utiliser quand on porte l'arme à deux mains.</p>
                <img class="img-fluid" src="images/armes.png">
                <figcaption>Exemple d'attaques.</figcaption>
                <p> En l'absence de label, on peut spécifier ces informations sous forme d'options d'attaque</p>
                <div class="alert alert-success" role="alert">
                  <p>Exemple pour le sort "<i>Flèche enflammée</i>" :</p>
                  <div class="decalage"><code>!cof2-attaque @{selected|token_id} @{target|token_id} Flèche de feu --toucher [[@{selected|atkmag}]] --dm 3d4e + [[@{selected|INT}]] --portee 30 --fx beam-fire --feu --sortilege --enflamme</code></div>
                </div>
                <p>Malus ou bonus temporaire à une attaque : utiliser la barre 3.</p>
                <p>Toutes les attaques ayant une portée non nulles sont considérées par le script comme des attaques à distance.</p>
                <p>Le test d'attaque à distance tient compte de la portée (malus de -1 à -5 si distance entre portée et deux fois cette valeur), ainsi que des tokens sur le trajet de l'attaque. Une attaque de trop loin ne porte jamais.</p>
                <p>Utiliser une attaque fait rentrer l'attaquant en combat (et le rajoute au turn tracker).</p>
                <p>Il existe une version spécialisée permettant de faire des dégâts dans un disque centré sur un token, <code>!cof2-explosion</code>, dont le premier argument doit être le label d'une attaque.</p>
              <h4 class="text-secondary">Options pour l'attaque&nbsp;:</h4>
              <div class="decalage">
                Toutes les options sans arguments peuvent être directement utilisées comme modificateurs dans le liste des modifcateurs d'une attaque. À noter que cette commande n'utilise pas les options de sélection ordinaires des autres commandes.
                <ul>
                  <li><code>--nom <i>txt</i></code> : nom de l'attaque à afficher. Remplace le nom dans la ligne d'attaque si on a donné un label en argument. Le nom ne doit pas comporte de blanc suivi de 2 tirets (<code> --</code>).</li>
                  <li><code>--toucher <i>n</i></code> : bonus de base de l'attaque. Remplace les valeurs dans la ligne d'attaque si on a donné un label en argument. Pour référence, sur les fiches de PJ, l'attaque au contact est <code>@{selected|atkcac}</code>, l'attaque à distance <code>@{selected|atktir}</code>, et l'attaque magique <code>@{selected|atkmag}</code>.</li>
                  <li><code>--crit <i>n</i></code> : valeur à partir de laquelle le jet de dé est un critique. Remplace les valeurs dans la ligne d'attaque si on a donné un label en argument.</li>
                  <li><code>--dm <i>expr</i></code> : Dégâts de base de l'attaque. Remplace les valeurs dans la ligne d'attaque si on a donné un label en argument. <i>expr</i> peut être un entier ou bien une expression du type <code><i>a</i>d<i>b</i>+<i>c</i></code>. La partie constante de cette expression est optionnelle et peut être négative.</li>
                  <li><code>--portee <i>n</i></code> : la portée de l'attaque exprimée en mètres. Remplace les valeurs dans la ligne d'attaque si on a donné un label en argument.</li>
                  <li><code>--special <i>txt</i></code> : remplace le champ spécial de l'attaque sur la fiche.</li>
                  <li><code>--tempDmg</code> : l'attaque fait des dégâts temporaires (tient compte de la force de l'adversaire, utilise la barre 2 pour les dmg temp, sauf si le token a des PM, auquel cas on utilisera un attribut temporaire).</li>
                  <li><code>--pasDeDmg</code> : l'attaque ne fait pas de DM.</li>
                  <li><code>--attaqueContactOpposee</code> : la difficulté du jet d'attaque est un jet d'attaque au contact de la cible.</li>
                  <li><code>--attaqueMagiqueOpposee</code> : la difficulté du jet d'attaque est un jet d'attaque magique de la cible.</li>
                  <li><code>--manoeuvre <i>nom</i></code> : l'attaque est une man&oelig;uvre de nom <i>nom</i>. En soit, affecte juste le rendement décroissant. Les autres effets doivent être spécifiés en option.</li>
                  <li><code>--poudre</code> : l'arme est une arme à poudre, utilisation d'un dé de poudre. Une arme est aussi considérée comme une arme à poudre si elle contient <code>poudre</code> dans le nom de l'arme ou dans le champ modifcateur ou de prédicats.</li>
                  <li><code>--epieu</code> : l'arme est un épieu. À noter que l'arme est aussi considérée comme un épieu si elle contient <code>épieu</code> dans son nom ou <code>epieu</code> dans son champs modificateurs ou prédicats. Cette option augmente de 1 le nombre de dés contre un adversaire sans armure.</li>
                  <li><code>--hache</code> : l'arme est une hache. À noter que l'arme est aussi considérée comme une hache si elle contient <code>hache</code> dans son nom ou dans son champs modificateurs ou prédicats. Cette option permet de passer la RD/hache (pour les sylvaniens, par exemple).</li>
                  <li><code>--marteau</code> : l'arme est un marteau. À noter que l'arme est aussi considérée comme un marteau si elle contient <code>marteau</code> dans son nom ou dans son champs modificateurs ou prédicats.</li>
                  <li><code>--arcCourt</code> : l'arme est un arc court. À noter que l'arme est aussi considérée comme un marteau si elle contient <code>arc court</code> dans son nom.</li>
                  <li><code>--auto</code> : l'attaque réussit automatiquement</li>
                  <li><code>--bonusAttaque <i>n</i></code> : ajoute <i>n</i> au jet d'attaque</li>
                  <li><code>--bonusCategorieDeTaille </code> : ajoute +5 au jet d'attaque par différence de catgéroie de taille entre l'attaquant et sa cible. Le bonus est négatif si la cible et plus grande que l'attaquant.</li>
                  <li><code>--bonusCritique <i>n</i></code> : augmente <i>n</i> à la plage de coups critiques</li>
                  <li><code>--modifiePortee <i>n</i></code> : ajoute <i>n</i> à la portée de l'attaque.</li>
                  <li><code>--divisePortee <i>n</i></code> : divise la portée de base par <i>n</i>. C'est appliqué avant toute modification de portée.</li>
                  <li><code>--armeDeContact</code> : indique que l'arme peut aussi être utilisée au contact, sans dé malus, avec la valeur d'attaque au contact, et en utilisant le bonus de force aux DM. C'est particulièrement utile pour les armes de jet, comme les dagues : on peut alors les mettre comme arme de jet, ce qui permet de compter combien il en reste en main, et de les utiliser aussi au ontact. Il faut bien mettre les bonus de toucher et de DM en version distance sur la fiche.</li>
                  <li><code>--bonusContreBouclier <i>n</i></code> : ajoute <i>n</i> au jet d'attaque si le défenseur porte un bouclier. Utile par exemple pour le fléau d'arme.</li>
                  <li><code>--bonusContreArmure <i>n</i></code> : ajoute <i>n</i> au jet d'attaque si le défenseur porte une armure.</li>
                  <li><code>--psave <i>carac seuil</i></code> : jet de <i>carac</i>, si le jet est supérieur à <i>seuil</i>, les dégâts sont divisés par 2. <i>carac</i> est l'abbréviation de caractéristiques de 3 lettres standard (FOR, DEX, ...). Il est possible de prendre la meilleure de 2 caractéristiques pour le save&nbsp;: pour cela indiquer les 2 caractéristiques collées (donc 6 caractères, par exemple FORDEX, pour le meilleur de FOR et de DEX). Le script choisira automatiquement la caractéristique qui donne les meilleures chances de réussite (en tenant compte de la difficulté et des caractéristiques supérieures).</li> Enfin on peut encore ajouter un ou des arguments optionnels. Si vous avez besoin de plus d'un argument optionnel, séparez-les par <code> +</code>:
                  <ul>
                    <li> Si on souhaite que le jet ne permette de réduire qu'une partie des dommages (la dernière ajoutée avec <code>--plus</code>), on peut ajouter <code>local</code>. La syntaxe complète est alors <code>--psave <i>carac seuil</i> local</code>.</li>
                    <li> Si on souhaite indiquer une difficulté alternative pour les cibles au contact, ajouter <code>contact <i>n</i></code>, où <i>n</i> est la difficulté en question.</li>
                    <li> Si on souhaite augmenter la difficulté du save en fonction de la marge de réussite du jet d'attaque, ajouter <code>augmenteAvecMargeDeToucher</code>.</li>
                  </ul>
                  </li>

                  <li><code>--dmSiRate <i>dmg</i></code> : si l'attaque rate, la cible est quand même touchée et se voit infliger <i>dmg</i> dégâts.</li>
                  <li><code>--toucheDoubleDmg</code> : si l'attaque rate, elle inflige les dégâts normaux, et si elle touche, elle double les dégâts de base. Pas cumulable avec <code>dmSiRate</code> ou <code>demiAuto</code>.</li>
                  <li><code>--draineMana <i>d</i></code> : si l'attaque touche, elle enlève <i>d</i> points de mana. <i>d</i> peut être un nombre une expression de dés simple, comme <code>1d4+1</code>.</li>
                  <li><code>--save <i>carac seuil</i></code> : même effet que <code>--psave</code>, mais pour annuler le dernier <code>--effet</code> ou <code>etat</code> (aucun effet sur les DM). Si on rajoute un argument <code>demiDuree</code> au save, alors la réussite du save ne fait que diviser par 2 sa durée.</li>
                  <li><code>--saveDM <i>carac seuil</i></code> : même effet que <code>--psave</code>, mais pour annuler l'ensemble des dégâts.</li>
                  <li><code>--saveParTour <i>carac seuil</i></code> : même effet que <code>--save</code>, mais donne droit à un jet à la fin de chaque tour au lieu d'un jet au moment de l'attaque.</li>
                  <li><code>--saveActifParTour <i>carac seuil</i></code> : même effet que <code>--save</code>, mais affiche un bouton pour faire le save dans la liste d'actions à chaque tour. Utile si les joueurs préfèrent jeter "eux-mêmes" le dé, ou si le save est sensé arriver au tour du joueur.</li>
                  <li><code>--saveParJour <i>carac seuil</i></code> : même effet que <code>--save</code>, mais donne droit à un jet à la fin de chaque jour au lieu d'un jet au moment de l'attaque.</li>
                  <li><code>--fx <i>effet</i></code> : ajoute un <a href="https://wiki.roll20.net/Custom_FX">effet</a> qui part de l'attaquant à la cible. Si l'attaque rate, l'effet rate aussi, d'autant plus que le jet d'attaque est loin de la défense. Il est possible d'utiliser un effet que vous avez défini vous-même en utilisant l'option <code>--fx custom <i>nom</i></code>, où <i>nom</i> est le nom de votre effet.</li>
                  <li><code>--fxCible <i>effet</i></code> : ajoute un <a href="https://wiki.roll20.net/Custom_FX">effet</a> au niveau de la cible (l'effet ne doit pas être directionnel). Comme avec <code>--fx</code>, on peut utiliser un effet qu'on a créé.</li>
                  <li>
                    <code>--conditionAttaque <i>condition</i></code> : l'attaque n'est possible que si <i>condition</i> est validée. Une condition peut être
                    <ul id="conditions">
                      <li><code>moins</code> <i>attribut</i> : vrai si l'attribut <i>attribut</i> de la cible est strictement moins haut que celui de l'attaquant</li>
                      <li><code>moitieMoins</code> <i>attribut</i> : vrai si l'attribut <i>attribut</i> de la cible est au plus la moitié de celui de l'attaquant</li>
                      <li><code>etat</code> <i>e</i> : vrai si l'état <i>e</i> est actif sur l'attaquant. Cet état peut être un des états définis plus bas, ou un attribut quelconque.</li>
                      <li><code>attribut</code> <i>attr</i> <i>val</i>: vrai si l'attaquant possède un attribut <i>attr</i>, de valeur <i>val</i>, aux majuscules près. On peut optionnellement préciser qu'il s'agit d'un attribut par token en rajoutant le mot clé <code>local</code>, ou encore qu'il sagit d'un attribut de la fiche, avec éventuellement sa valeur par défaut, en ajoutant le mot clé <code>fiche <i>defaut</i></code>.</li>
                      <li><code>etatCible</code> <i>e</i> : vrai si l'état <i>e</i> est actif sur toutes la cible. Cet état peut être un des états définis plus bas, ou un attribut quelconque.</li>
                      <li><code>attributCible</code> <i>attr</i> <i>val</i>: vrai si la cible possède un attribut <i>attr</i>, de valeur <i>val</i>, aux majuscules près. On peut optionnellement préciser qu'il s'agit d'un attribut par token en rajoutant le mot clé <code>local</code>, ou encore qu'il sagit d'un attribut de la fiche, avec éventuellement sa valeur par défaut, en ajoutant le mot clé <code>fiche <i>defaut</i></code>.</li>
                      <li><code>predicatCible</code> <i>predicat</i>: vrai si la cible possède un prédicat <i>predicat</i>. On peut aussi spécifier une valeur auquel le prédicat doit être égal.</li>
                      <li><code>typeCible</code> <i>type</i>: vrai si la cible est du type spécifié. Les types reconnus sont <code>animal</code>, <code>démon</code>, <code>dragon</code>, <code>fée</code>, <code>insecte</code>, <code>mauvais</code>, <code>mort-vivant</code>, <code>géant</code>, <code>gobelin</code>, et si le type n'est pas reconnu, va chercher si la race ou un prédicat correspondant.</li>
                      <li><code>deAttaque</code> <i>n</i> : vrai si le jet de dé d'attaque est supérieur ou égal à <i>n</i>.</li>
                      <li><code>touche</code> : vrai si l'attaque touche.</li>
                      <li><code>critique</code> : vrai si l'attaque est un critique.</li>
                      <li><code>echecCritique</code> : vrai si l'attaque est un échec critique.</li>
                      <li><code>premiereAttaque</code> : vrai si c'est la première attaque du combat.</li>
                    </ul>
                  </li>
                  <li><code>--if <i>condition</i></code> <i>options</i> <code>--endif</code>: permet de ne prendre en compte des options que si certaines conditions sont réalisées. Il est possible d'utiliser un <code>--else</code> pour activer des options quand les conditions ne sont pas réalisées. Attention, les options qui modifient une option précédente (comme <code>--valeur</code>) doivent apparaître au même niveau que l'option qu'elles modifient. Comme les conditions peuvent dépendre du dé d'attaque, un certain nombre d'options ne sont pas affectées par cette conditionnelle : les options d'aoe (ligne, cone, disque, target), auto, test, tempsRecharge, sortilege, bonusCritique, affute, poudre, feinte, magique, tranchant, perforant, contondant, pasDeDmg. Ne pas hésiter à me demander si vous aviez besoin que l'une de ces options puissent être conditionnelle.</li>
                  <li><code>--ifSaveFails <i>carac seuil</i></code> <i>options</i> <code> --endif</code> : comme <code>--if</code>, mais fait réaliser une jet de sauvegarde à la cible (comme avec <code>--save</code>), et si le test est raté, applique les options qui suivent. Un <code>--else</code> permet de choisir des options à appliquer quand le test est réussi. À utiliser seulement si on ne peut pas se contenter d'un <code>--save</code>, car ça marche moins bien.</li>
                  <li><code>--decrAttribute <i>nom</i></code> : l'attaque n'est possible que si l'attribut existe et si sa valeur est strictement positive. L'attaque diminue cette valeur de 1. On peut preciser une valeur plus grande après le nom de l'attribut (<code>--decrAttribute <i>nom</i> <i>d</i></code> teste si la valeur est supérieure à <i>d</i> et la diminue de <i>d</i>). Si cette option est utilisée à l'intérieur d'un <code>--if</code>, alors l'option se contente de diminuer l'attribut (on peut savoir si la valeur est positive grâce à <code>--if etat <i>nom</i></code>).</li>
                  <li><code>--decrLimitePredicatParTour <i>nom</i></code> : l'attaque n'est possible que si un prédicat <i>nom</i> existe et si elle n'a pas été utilisée plus de fois dans le tour que la valeur de ce prédicat. L'attaque augmente ce nombre de 1.</li>
                  <li><code>--tempsRecharge <i>effet</i> <i>duree</i></code> : l'attaque n'est possible que si l'effet est inactif sur l'attaquant, et de plus active l'effet sur l'attaquant pour la durée indiquée si l'attaque est possible. Il existe un effet temporaire générique, <code>rechargeGen(<i>desc</i>)</code> que vous pouvez utiliser si aucun effet existant ne correspond pour votre attaque.</li>
                  <li><code>--etat <i>e</i></code>: si l'attaque touche, la cible passe dans l'état <i>e</i>. Il est aussi possible de spécifier une caractéristique et un seuil (comme pour <code>!cof-set-state</code>) pour faire afficher à chaque tour une action permettant de se libérer de l'état.</li>
                  <li><code>--finEtat <i>e</i></code>: si l'attaque touche, la cible sort de l'état <i>e</i>.</li>
                  <li><code>--effet <i>e duree</i></code> : ajoute à la cible l'effet temporaire <i>e</i> pour la duree spécifiée. Pour que cela soit automatiquement mis à jour, il faut utiliser le turn tracker. Noter que l'argument de durée peut être omis pour certains effets, comme ceux qui par définition durent tout le combat.</li>
                  <li><code>--finEffet <i>e </i></code> : enlève à la cible l'effet temporaire <i>e</i>.</li>
                  <li><code>--valeur <i>v</i></code> : spécifie une valeur au dernier effet mentionné.</li>
                  <li><code>--optionEffet <i>opt arg1 arg2 ...</i></code> : spécifie une option au dernier effet mentionné. L'option <i>opt</i> doit être donnée sans le <code>--</code> et sera passée telle quelle à l'effet, par exemple pour les dégâts périodiques, si on ne veut pas que la RD s'applique, on pourra ajouter <code>--optionEffet ignoreRD</code>.</li>
                  <li><code>--plus <i>dmg</i></code> : ajoute <i>dmg</i> dégâts. Attention, si <i>dmg</i> est un simple nombre, ces dégâts sont multipliés par les critiques (sauf si de type différent de l'attaque principale). Ainsi, <code>--plus [[1d6]]</code> donnera des dégâts multipliés par les critiques (car la fonction ne voit que le résultat du jet), alors que <code>--plus 1d6</code> ne le sera pas. </li>
                  <li><code>--plusCrit <i>dmg</i></code> : ajoute <i>dmg</i> dégâts en cas de réussite critique</li>
                  <li><code>--test</code> pour voir le résultat du jet d'attaque. On n'applique pas les résultats d'un touché.</li>
                  <li><code>--sournoise <i>n</i></code> : ajoute <i>n</i>d6 de dégâts d'attaque sournoise ou par surprise. Si l'option n'a pas d'argument, le nombre de dés rajoutés sera celui associé à un prédicat <code>attaqueSournoise</code>, et si l'attaquant n'a pas de prédicat <code>attaqueSournoise</code>, l'attaque ajoute juste 1d6. Le script limite le nombre d'attaque sournoise par personnage à 1 par tour. On peut augmenter ce nombre en utilisant un prédicat <code>sournoisesParTour</code>, de valeur la limite au nombre de sournoises pour ce personnage.</li>
                  <li><code>--magique</code> : les dégâts sont magiques. On peut passer en argument le niveau de magie. Il est utilisé contre les créatures immunisées aux armes. Le niveau par défaut est 1.</li>
                  <li><code>--+<i>k</i></code> : l'attaque utilise une arme magique +<i>k</i>. Pratique à mettre dans les modificateurs de l'attaque (dans ce cas, on n'a pas les <code>--</code>), cela rajoute les bonus au toucher et aux dégâts, et indique que les dégâts sont magiques. Si un niveau de magie est spécifié, rajoute <i>k</i> à ce niveau.</li>
                  <li><code>--feu</code>, <code>--acide</code>, <code>--electrique</code>, <code>--froid</code>, <code>--sonique</code>, --<code>poison</code>, --<code>maladie</code>, <code>--argent</code>, <code>--drain</code>, <code>--energie</code>&nbsp;: les dégâts sont de type feu, acide, électrique, froid, sonique, poison, maladie, argent, drain ou énergie. Le type spécifie uniquement le dernier <code>--plus</code> précédent cette option, ou si il n'y en a pas, celui des dégâts principaux. Seul le dernier type spécifié est pris en compte (pas de type multiple pour l'instant). Le type affecte différents attributs, et aussi la couleur d'affichage des dégâts.</li>
                  <li><code>--beni</code> : les dégâts sont d'une source sainte ou bénie. Sert principalement à signaler pour les résistances aux dégâts qui peuvent dépendre de cela (genre RD 5/beni).</li>
                  <li><code>--spectral</code> : L'attaque peut toucher les créatures intangibles.</li>
                  <li><code>--tranchant</code>, <code>--perforant</code>, <code>--contondant</code> : précise le type d'arme (si pertinent), pour pouvoir utiliser les RD spécifiques à un type d'arme.</li>
                  <li><code>--ignoreRD</code> : l'attaque ignore les RD et division de DMs. Il est possible de donner en argument une valeur de RD ignorée, de sorte que l'attaque ignore les RD jusqu'à cette valeur. Par exemple on pourra écrire <code>--ignoreRD 5</code>.</li>
                  <li><code>--ignoreMoitieRD</code> : l'attaque ignore la moitié de la RD.</li>
                  <li><code>--sortilege</code> pour indiquer qu'il s'agit d'un sortilège, de façons à pouvoir appliquer tous les effets spécifiques aux sorts. Cette options devrait être passées pour toutes les capacités suivies d'une étoile dans le livre des règles. En particulier, tout sortilege ignore les malus d'obstacles. Pour les attaques qui n'utilisent pas une ligne d'attaque de la fiche, utilise l'attaque magique pour toucher par défaut.</li>
                  <li><code>--reroll1</code> : relance les 1 aux dés de dégats. À noter que cela ne concerne que les dés de base de l'attaque, pas les DM supplémentaire. </li>
                  <li><code>--explodeMax</code> : relance les valeurs maximum aux dés de DM de base, et rajoute le nouveau résultat (qui lui-même explose).</li>
                  <li><code>--mana <i>n</i></code> : l'attaque coûte <i>n</i> points de mana. Si l'attaque provoque un effet temporaire, le script essaiera de le supprimer à la mort du lanceur (même avec un coût nul).</li>
                  <li><code>--limiteParJour <i>l</i></code> : limite le nombre d'utilisations de cette attaque à <i>l</i> fois par jour. On peut préciser un nom après <i>l</i>, qui va correspondre à une ressource pouvant être partagée avec d'autres attaques ou d'autres effets (voir <code>!cof-effet-temp</code>). Par défaut, le nom de cette ressource est le label de l'attaque. On peut remplacer le nombre <i>n</i> par le nom d'un prédicat dont la valeur sera utilisée.</li>
                  <li><code>--limiteParCombat</code> : même effet que la limite par jour. Si aucun argument n'est donné, la limite est de une fois par combat.</li>
                  <li><code>--limiteParTour</code> : même effet que la limite par jour. Si aucun argument n'est donné, la limite est de une fois par tour.</li>
                  <li><code>--seulementDistance</code> : l'attaque ne peut être réalisée que contre un adversaire à distance.</li>
                  <li><code>--seulementVivant</code> : n'affecte que les cibles vivantes</li>
                  <li><code>--forceMinimum <i>n</i></code> : l'attaque n'est possible que si l'attaquant a au moins <i>n</i> en force.</li>
                  <li><code>--ferFroid</code> : multiplie par 2 les dégâts contre les fées et les démons (le script reconnaît certaines races et les prédicats <code>démon</code> et <code>fée</code>).</li>
                  <li><code>--adamantium</code> : l'arme utilisée est en adamantium. Reconnu pour la RD.</li>
                  <li><code>--tueurDe <i>categorie</i></code> : bonus de +2 en attaque et +2d6 DM contre les espèces appartenant à la catégorie (voir la condition <code>typeCible</code>.</li>
                  <li><code>--tueurDeGrands</code> : bonus de +1d6 DM contre les créatures de taille grande et +2d6 DM contre les créatures de taille énorme ou plus.</li>
                  <li><code>--ignoreObstacles</code> : ignore les tokens sur le trajet. Ça semble nécessaire pour les attaques magiques d'après Kegron.</li>
                  <li><code>--retourneEnMain</code> : L'arme de jet revient en main après l'attaque.</li>
                  <li><code>--deBonus</code> : lance un dé de plus en attaque et garde le meilleur. plusieurs arguments avantage se cumulent et sont annulés par les désavantages (syntaxe alertnative: (<code>--m2d20</code>)</li>
                  <li><code>--deMalus</code> : lance un dé de plus en attaque et garde le moins bon. plusieurs arguments désavantage se cumulent et sont annulés par les avantages.</li>
                  <li><code>--incrDmgCoef <i>n</i></code> : augmente le coefficient des dégâts de base de 1. Les dégâts de base comprennent les dés de dommage de l'arme (ou du sort), plus tous les bonus constants. Le coefficient par défaut est de 1, et une réussite critique augmente ce coefficient de 1.</li>
                  <li><code>--incrCritCoef <i>n</i></code> : augmente le coefficient des dégâts critiques de <i>n</i> (1 si on ne donne pas d'argument).</li>
                  <li><code>--diviseDmg <i>n</i></code> : divise les dégâts de base par <i>n</i>.</li>
                  <li><code>--maxDmg</code> : l'attaque inflige le maximum de DM permis par les dés de base.</li>
                  <li><code>--difficultePVmax</code> : la difficulté du jet d'attaque est le maximum de PVs au lieu de la défense.</li>
                  <li><code>--difficultePV</code> : la difficulté du jet d'attaque est la valeur courante des PVs au lieu de la défense.</li>
                  <li><code>--difficulteCarac <i>carac</i></code> : la difficulté du jet d'attaque est une des caractéristiques de la cible (sous forme de code à 3 lettres, <code>FOR</code>, <code>DEX</code>, etc). Il est possible de prendre le meilleur de 2 caractéristiques en écrivant les 2 noms collés. Par exemple, pour viser le meilleur de l'intelligence et du charisme, on écrira <code>--difficuletCarac INTCHA</code>.</li>
                  <li><code>--affute</code> : augmente de 1 les chances de crit et +1d6 aux DM des crit.</li>
                  <li><code>--enflamme</code> : enflamme la cible, lui infligeant 1d6 DM par tour. Les flammes s'éteindent sur un 1 ou 2. Si l'option <code>--puissant</code> est donnée en conjonction, les DM augmentent de 1.</li>
                  <li><code>--rate</code>, <code>--touche</code>, <code>--critique</code>, <code>--echecCritique</code>, <code>--pasDEchecCritique</code> : options pour tricher : le résultat des dés donne toujours le résultat voulu.</li>
                  <li><code>--ligne</code> : l'attaque porte sur toutes les cibles à portée, entre l'attaquant et le token ciblé. Si le token ciblé est plus proche que la portée de l'attaque, les tokens derrière le token ciblé sont aussi visés. Pour permettre de viser un point quelconque, on peut utiliser un personnage dédié avec un maximum de 0 pv. À chaque fois qu'un token représentant ce personnage est utilisé comme cible de <code>--ligne</code>, le token est enlevé de la carte.</li>
                  <li><code>--disque <i>r</i></code> : l'attaque porte sur toutes les cibles dans le disque de centre le token ciblé et de rayon <i>r</i>. Comme pour <code>--ligne</code>, on peut utiliser un token cible qui sera supprimé après l'attaque. À noter que l'attaquant lui-même peut prendre des dégâts, sauf si l'attaque a une portée nulle et que l'attaquant se cible lui-même (attaque centrée sur le lanceur). On peut donner en argument optionel le mot <code>souffleDeMort</code> pour ne valider l'attaque que si le centre du disque est un personnage mort depuis moins d'un tour et ne garder que les alliés de ce personnage de niveau inférieur ou égal.</li>
                  <li><code>--cone <i>angle</i></code> : cible toutes les créatures dans un cône de sommet l'attaquant, d'angle <i>angle</i> degrés (90 degrés par défaut), et séparé en deux par le segment joignant l'attaquant et le token visé.</li>
                  <li><code>--explosion</code> : si l'attaque n'est pas déjà un disque, considère qu'elle forme un disque de rayon égal à la portée. L'attaquant est automatiquement exclus de la zone.</li>
                  <li><code>--dmCible <i>dmg</i></code> : utilisé conjointement aux options de zone ci-dessus, cette option permet de remplacer les dommages de base de l'attaque spécifiquement sur la cible sélectionnée lors de l'attaque</li>
                  <li><code>--saufAllies</code> : ne cible pas les allies dans la zone ou les cibles spécifiées.</li>
                  <li><code>--cible <i>id</i></code> : ajoute une cible à l'attaque (s'ajoute à la cible principale et aux options d'aoe).</li>
                  <li><code>--ciblesDansDisque <i>n</i></code> : impose que les différentes cibles soient dans un disque de rayon <i>n</i>.</li>
                  <li><code>--message <i>texte</i></code> : ajoute une ligne avec le message dans la fenêtre de l'attaque. Attention, <i>texte</i> ne doit pas contenir la séquence <code> --</code>.</li>
                  <li><code>--secret</code> : affiche les jets et résultats de l'attaque seulement aux joueurs qui contrôlent l'attaquant ou ses cibles, ainsi qu'au MJ.</li>
                  <li><code>--allonge <i>n</i></code> : ajoute <i>n</i> mètres à la portée d'une attaque au contact. L'allonge peut être un nombre à virgule et même négative.</li>
                  <li><code>--soundAttack <i>son</i></code> : joue le son <i>son</i>, à moins qu'une version plus longue de l'option (voir ci-dessous) n'existe et qu'elle soit active.</li>
                  <li><code>--soundAttackEchec <i>son</i></code> : joue le son <i>son</i> lorque l'arme fait un echec, sauf si c'est un échec particulier et une version plus longue existe.</li>
                  <li><code>--soundAttackEchecCritique <i>son</i></code> : joue le son <i>n</i> lorque l'arme fait un echec critique</li>
                  <li><code>--soundAttackSucces <i>son</i></code> : joue le son <i>son</i> lorque l'arme fait un succès</li>
                  <li><code>--soundAttackSuccesCritique <i>son</i></code> : joue le son <i>n</i> lorque l'arme fait un succès critique</li>
                  <li><code>--imgAttack <i>img</i></code> : Affiche dans le chat l'image (.jpg/.png/.gif) <i>img</i>, à moins qu'une version plus longue de l'option (voir ci-dessous) n'existe et qu'elle soit active.</li>
                  <li><code>--imgAttackEchecCritique <i>img</i></code> : Affiche dans le chat l'image (.jpg/.png/.gif) <i>img</i> lorque l'arme fait un echec critique</li>
                  <li><code>--imgAttackEchec <i>img</i></code> : Affiche dans le chat l'image (.jpg/.png/.gif) <i>img</i> lorque l'arme fait un echec</li>
                  <li><code>--imgAttackSuccesCritique <i>img</i></code> : Affiche dans le chat l'image (.jpg/.png/.gif) <i>img</i> lorque l'arme fait un succès critique</li>
                  <li><code>--imgAttackSucces <i>img</i></code> : Affiche dans le chat l'image (.jpg/.png/.gif) <i>img</i> lorque l'arme fait un succès</li>
                  <li><code>--terrainDifficile <i>duree</i></code> : si l'attaque affecte une zone en forme de disque, cette zone sera considérée comme du terrain difficile pendant <i>duree</i> tours. En deuxième argument, on peut mettre le nom de la zone, et en troisième argument une image à afficher sur la carte.</li>
                  <li><code>--deplaceDe <i>dmax</i></code> : l'attaquant se déplacer de <i>dmax</i> mètres maximum pour arriver à portée de sa cible. Le déplacement (et l'attaque) n'a lieu que si il existe une position libre, sans aucun token sur le trajet. On peut spécifier une distance minimum avec <code>--deplaceDe <i>min</i> <i>max</i></code>. On peut aussi ajouter le mot-clé <code>saut</code> pour ignorer les tokens sur le trajet.</li>
                  <li><code>--repousseCible <i>d</i></code> : l'attaque fait reculer la cible de <i>d</i> mètres. Un bouton propose de déplacer la cible, et l'attaquant suit automatiquement. Si la cible ne peut pas se déplacer de toute la distance, elle subit un malus en DEF égal à la distance restante.</li>
                  <li><code>--suceLeSang <i>valOpt</i></code>; garde le compte des DM jusqu'à atteindre <i>valOpt</i> (7 par défaut).</li>
                </ul>
              </div>
              <h4 class="text-secondary">Recharger des armes : <code>!cof2-recharger @{selected|token_id} <i>N</i></code></h4>
              <div class="decalage">
                <p>Pour indiquer qu'une arme doit être rechargée, et l'action nécessaire pour recharger, il suffit d'ajouter l'option <code>--recharger <i>action</i></code>, où <i>action</i> peut être <code>M</code>, <code>A</code> ou <code>L</code>. Avec cette option le script va noter si l'arme est chargée ou non (elle est supposée chargée au début du combat), et proposer dans les actions de recharger cette arme, si aucun adversaire n'est au contact. Si vous avez besoin de recharger une arme en dehors du cadre prévu, vous pouvez utiliser la commande <code>!cof2-recharger @{selected|token_id} <i>N</i></code>, où <i>N</i> est le label de l'attaque (pas le nom !).</p>
              <!--  La commande admet un argment optionel <code>--grenaille</code> pour charger (une arme à poudre) avec de la grenaille.
              -->
              </div>
              <h4 class="text-secondary" id="couvert">Couvert :<code>!cof2-effet bonusCouvert <i>b</i></code></h4>
              <div class="decalage">
                <p>Le script détermine automatiquement un malus de couverture pour les attaques à distance qui dépend des tokens présents sur le layer object entre le tireur et sa cible. Si vous ne voulez pas mettre des tokens en plus pour représenter les obstacles inertes, vous pouvez aussi associer un bonus de couvert à un personnage, qui s'appliquera contre toute les attaques à distance, avec <code>!cof2-effet bonusCouvert ?{Bonus du couvert?}</code> en sélectionnant les tokens bénéficiant du couvert. La commande accepte un argument <code>--secret</code> permettant de ne pas faire connaître l'action du personnage à tous les joueurs. Pour ne plus être à couvert, il suffit de lancer la commande <code>!cof2-effet bonusCouvert fin</code> ou d'utiliser le statut des personnages, qui va proposer un bouton pour mettre fin à l'effet.
                </p>
              </div>
              <h4 class="text-secondary">Réduction des dégâts</h4>
              <div class="decalage">
                <h5>Fonctionnement de base</h5>
                <ul>
                  <li>Le script utilise la case RD présente sur les fiches.</li>
                  <li>Il est possible d'indiquer plusieurs RD différentes, il suffit de les séparer par une virgule.</li>
                  <li>Toutes les RD se cumulent.</li>
                  <li>Le script se base sur les types de dégâts pour choisir d'appliquer ou non les dégâts.</li>
                  <li>Pour les armes magiques, il est possible de spécifier à la fois le type de l'arme (par exemple <code>--tranchant</code>) et <code>--magique</code>.</li>
                </ul>
                <h5>RD simple</h5>
                <p>Dans le cas d'une RD simple (résistance à tous les dégâts), il suffit d'indiquer un nombre. Exemple : <code>3</code></p>
                <h5>RD à un type de dégâts particuliers</h5>
                <p>Pour une RD qui ne s'applique qu'à un type de dégâts particuliers, indiquer le type et la valeur séparés par <code>:</code>. Exemple : <code>feu:5</code>. On peut aussi spécifier une RD conte tous les types élémentaires avec le mot clé <code>elementaire</code>. On peut aussi avoir une RD qui ne s'applique qu'aux attaques à distance avec le mot clé <code>distance</code>.</p>
                <h5>RD sauf un ou plusieurs types de dégâts particuliers</h5>
                <p>Pour une RD qui s'applique tout le temps sauf un ou plusieurs types de dégâts particuliers, indiquer la valeur puis <code>/</code> puis les différents types séparés par <code>_</code>. Exemple <code>/</code>. Exemple : <code>5/argent_magique</code><br/>
                Pour une RD qui s'appliquerait à tous les types d'armes sauf une, utiliser à la place une résistance aux 2 autres types d'armes. Exemple, pour 5/tranchant, utiliser <code>perforant:5,contondant:5</code>.</p>
                <h5>RD critique</h5>
                <p>Utiliser un <a href=#predicats>prédicat</a> <code>RD_critique</code> avec comme valeur la résistance aux critiques. Se combine avec une éventuelle RD critique fournie par le port d'un casque.</p>
                <h5>Résistances</h5>
                <p>Pour les effets qui divisent la dégâts subits d'un type donné, utilisez un <a href=#predicats>prédicat</a> <code>resistanceA_<i>type</i></code>. Une resistance à tous les dégâts non-magiques est possible avec <code>resistanceA_nonMagique</code>.<!--Il est aussi possible d'octroyer une résistance temporaire, par exemple une potion de résistance au feu pourra être simulée par la commande <code>!cof-set-attribute resistanceA_feu true</code>. Cela ne sera pas visible dans les prédicats, local à un mook, et il faut ensuite effacer l'attribut à la fin de l'effet-->.</p>
                <p>Pour les effets qui divisent par 2 les dégâts ou la durée, utiliser un <a href=#predicats>prédicat</a> <code>diviseEffet_<i>type</i></code>.</p>
                <p>Pour les effets qui donnent un bonus aux tests pour résister aux effets ou dégâts d'un certain type, utiliser un <a href=#predicats>prédicat</a> <code>bonusSaveContre_<i>type</i></code> de valeur le bonus accordé. Par exemple, un objet qui donnerait +5 à tous les tests pour résister au poison pourrait être encodé par un prédicat <code>bonusSaveContre_poison</code> de valeur <code>5</code>.</p>
                <!--
                <h5>Armures/Boucliers de Protection (COF p. 203)</h5>
                <p>ajoutez un <a href=#predicats>prédicat</a> <code>armureProtection</code> ou <code>bouclierProtection</code>. Le script détecte si l'équipement est porté ou pas via la fiche, et fonctionne spécifiquement contre les attaques qui utilisent <code>--sournoise</code>. Il est aussi possible de spécifier le port d'un anneau de protection ayant le même effet (prédicat <code>anneauProtection</code>.</p>
                -->
              </div>
              </div>
              <h3 class="text-info" id="dm_et_soins">2.3 Dégâts et soins :</h3>
              <div class="decalage">
              <h4 class="text-secondary">Dégâts directs : <code>!cof2-dmg <i>dm</i></code></h4>
              <div class="decalage">
                <p>Applique des dégâts à tous les tokens sélectionnés. L'argument <i>dm</i> peut être un inline roll. Utile par exemple pour les chutes, ou bien les dégâts d'environnement, voire de pièges.<br />
                Arguments optionels: une partie des options de <code>!cof2-attaque</code>, dont le type, et par exemple <code>--psave <i>carac seuil</i></code> (jet de <i>carac</i>, si supérieur au <i>seuil</i>, les dégâts sont divisés par 2). On peut aussi donner un titre aux dégâts en utilisant l'option <code>--titre</code>
                </p>
                <p> Il est possible d'infliger des dégâts sur la durée en utilisant la commande <code>!cof2-effet dotGen(<i>nom</i>) <i>duree</i> --valeur <i>expr</i> <i>type</i></code>. Les arguments de <code>--valeur</code> donnent l'expression à évaluer, de type lancé de dé, et le type de dégâts. Par défaut, si rien n'est précisé, c'est <code>1d6</code> et <code>normal</code>. On peut utiliser les options habituelles de <code>!cof-effet-temp</code>. Ainsi, si on souhaite infliger des dégâts de poison de 1d4+1 par tour, pendant 10 tours, avec un jet de CON difficulté 12 pour arrêter l'effet, on pourra écrire <code>!cof-effet-temp dotGen(monPoison) 10 --saveParTour CON 12 --valeur 1d4+1 poison</code>.
                </p>
              </div>
                <h4 class="text-secondary">Soins: <code>!cof2-soin <i>x</i></code></h4>
                <div class="decalage">
                  <p><i>x</i> peut être un nombre, un jet de dé ou <code>mineur</code> ou <code>majeur</code>.</p>
                  <p>Si besoin, la personne qui soigne peut être spécifiée avec l'options <code>--acteur</code>.</p>
                  <span>Options (en plus de options normales de commandes):</span>
                  <ul>
                    <li><code>--portee <i>n</i></code> : permet de spécifier une distance maximum entre le soigneur et le soigné (au-delà, le soin échoue)</li>
                    <li><code>--transfer</code> : le soin est payé avec les PV du soigneur</li>
                    <li><code>--mana <i>n</i></code> : demande au lanceur de payer <i>n</i> points de mana</li>
                    <li><code>--limiteSoinsParJour <i>n</i></code> : limite le nombre total de PVs soignés par jour. Cette limite peut être associée à une ressource (spécifier en deuxième argument de l'option, peut contenir des espaces), de sorte que seuls les soins qui mentionnent cette ressource sont concernés par cette limitation. Cette option n'a de sens que si un soigneur est précisé.</li>
                    <li><code>--sacrifierPV</code> : le soigneur doit sacrifier autant de PV que le montant des soins (que ces soins soient utilisés ou non).</li>
                  </ul>
                </div>
                <h4 class="text-secondary">Premiers soins: <code>!cof2-premiers-soins @{selected|token_id} @{target|token_id}</code></h4>
                <div class="decalage">
                  <p>Le script crée une action de token pour cette commande. Après les premiers soins, il fait faire passer le temps pour que la cible revienne à elle.</p>
                </div>
              </div>
              <h3 class="text-info" id="statut_etats">2.4 Statut et états</h3>
              <div class="decalage">
                <p><code>!cof2-statut</code> affiche l'état courant de tous les tokens sélectionnés. Utile pour connaître facilement les états qui ne sont pas directement visibles sur un token (points de récupération, armes chargées, ...). Il est possible de rajouter l'affichage d'autres attributs que ceux sélectionnés par défaut par le script. Pour cela, utiliser un prédicat <code>attributsDeStatut</code>, de valeur la liste des noms d'attributs à afficher, séparés par des virgules. Attention, si vous avez besoin de séparer vos attributs par des virgules, pensez à utiliser la syntaxe avec <code>"</code>. Si vous le souhaitez, vous pouvez utiliser plusieurs prédicats nommés <code>attributsDeStatut</code>. </p>
                <h4 class="text-secondary" id="etats">États gérés en utilisant le statut des tokens</h4>
                <div class="decalage">
                  <p><code>!cof2-effet <i>etat</i> <i>[true|false]</i></code> permet de changer l'état des tokens sélectionnés. Si cet état concerne un personnage avec tokens liés (en liant la barre 1 aux points de vie), alors l'état persiste si on change de carte (utilisation d'un attribut hors fiche).</p>
                  <p>Liste des états et markers correspondants :</p>
                  <table>
                    <thead>
                      <tr style="border-bottom: 1px solid black" >
                        <th scope="col">État</th>
                        <th scope="col">Source</th>
                        <th scope="col">Remarque</th>
                        <th scope="col" width="145px">Marker Std.</th>
                        <th scope="col" width="135px">Marker COF</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <th scope="row">Affaibli</hd>
                          <td>LdB p214</td>
                          <td>Apparaît sur la fiche perso</td>
                          <td><code>half-heart</code></td>
                          <td><code>cof-affaibli</code></td>
                      </tr>
                      <tr>
                        <th scope="row">Apeuré</hd>
                          <td></td>
                          <td>Victime d'un sort de Peur</td>
                          <td><code>screaming</code></td>
                          <td><code>cof-apeure</code></td>
                      </tr>
                      <tr>
                        <th scope="row">Assommé</hd>
                          <td>LdB p218</td>
                          <td></td>
                          <td><code>pummeled</code></td>
                          <td><code>cof-assomme</code></td>
                      </tr>
                      <tr>
                        <th scope="row">Aveuglé</hd>
                          <td>LdB p214</td>
                          <td>Change aussi la vision du token</td>
                          <td><code>bleeding-eye</code></td>
                          <td><code>cof-aveugle</code></td>
                      </tr>
                      <tr>
                        <th scope="row">Blessé</hd>
                          <td>Atlas p205</td>
                          <td></td>
                          <td><code>arrowed</code></td>
                          <td><code>cof-blesse</code></td>
                      </tr>
                      <!--
                      <tr>
                        <th scope="row">Encombré</hd>
                          <td>Comp p103</td>
                          <td></td>
                          <td><code>frozen-orb</code></td>
                          <td><code>cof-encombre</code></td>
                      </tr>
                      -->
                      <tr>
                        <th scope="row">Endormi</hd>
                          <td></td>
                          <td></td>
                          <td><code>sleepy</code></td>
                          <td><code>cof-endormi</code></td>
                      </tr>
                      <tr>
                        <th scope="row">Essoufflé</hd>
                          <td>LdB p214</td>
                          <td></td>
                          <td><code>half-haze</code></td>
                          <td><code>cof-essouffle</code></td>
                      </tr>
                      <tr>
                        <th scope="row">Étourdi</hd>
                          <td>LdB p214</td>
                          <td></td>
                          <td><code>half-haze</code></td>
                          <td><code>cof-etourdi</code></td>
                      </tr>
                      <tr>
                        <th scope="row">Invalide</hd>
                          <td>LdB p214</td>
                          <td></td>
                          <td><code>tread</code></td>
                          <td><code>cof-invalide</code></td>
                      </tr>
                      <tr>
                        <th scope="row">Invisible</hd>
                          <td></td>
                          <td>Sort d'invisibilité</td>
                          <td><code>ninja-mask</code></td>
                          <td><code>cof-invisible</code></td>
                      </tr>
                      <tr>
                        <th scope="row">Immobilisé</hd>
                          <td>LdB p214</td>
                          <td></td>
                          <td><code>cobweb</code></td>
                          <td><code>cof-immobilise</code></td>
                      </tr>
                      <tr>
                        <th scope="row">Mort</hd>
                          <td>LdB p220</td>
                          <td>Même état pour un PJ juste inconscient à 0 PV</td>
                          <td><code>dead</code></td>
                          <td><code>dead</code></td>
                      </tr>
                      <tr>
                        <th scope="row">Paralysé</hd>
                          <td>LdB p215</td>
                          <td></td>
                          <td><code>fishing-net</code></td>
                          <td><code>cof-paralyse</code></td>
                      </tr>
                      <tr>
                        <th scope="row">Ralenti</hd>
                          <td>LdB p215</td>
                          <td></td>
                          <td><code>snail</code></td>
                          <td><code>cof-ralenti</code></td>
                      </tr>
                      <tr>
                        <th scope="row">Renversé</hd>
                          <td>LdB p215</td>
                          <td></td>
                          <td><code>back-pain</code></td>
                          <td><code>cof-renverse</code></td>
                      </tr>
                      <tr>
                        <th scope="row">Surpris</hd>
                          <td>LdB p215</td>
                          <td></td>
                          <td><code>lightning-helix</code></td>
                          <td><code>cof-surpris</code></td>
                      </tr>
                      <tr>
                        <th scope="row">Pénombre</hd>
                          <td>LdB p215</td>
                          <td></td>
                          <td><code>archery-target</code></td>
                          <td><code>cof-penombre</code></td>
                      </tr>
                    </tbody>
                  </table>
                  <p>Pour faciliter la gestion des états, on peut mettre deux macros dans la barre du GM, <code>!cof2-effet ?{État|mort|surpris|assomme|renverse|aveugle|affaibli|etourdi|paralyse|ralenti|immobilise|endormi|apeure|invisible|blessé|encombre} true</code>, et la même avec <code>false</code>. (N'oubliez pas que la commande <code>!cof2-set-macros</code> permet de générer automatiquement les macros utiles au script). Une fois qu'on connaît bien les icônes, on peut directement les changer sur les tokens pour le même effet (et même faire un undo de ces changements si besoin).  </p>
                  <p>À noter qu'un personnage ayant un <a href=#predicats>prédicat</a> nommé <code>immunite_<i>etat</i></code> ne pourra pas être mis dans l'état <i>etat</i>.</p>
                  <p>Enfin, il est possible de faire réaliser un jet pour se libérer d'un état, en utilisant la commande <code>!cof-save-state <i>etat</i> <i>carac</i> <i>seuil</i></code>. Il est possible de remplacer <i>seuil</i> par une id de token pour faire faire un test en opposition avec ce token. On peut aussi passer la caractéristique et le seuil en argument à <code>!cof2-set-state</code> pour proposer le jet à chaque fois qu'on affiche les <a href="#actions_du_tour">actions du tour</a> ou qu'on affiche le statut du personnage.</p>
                </div>
                <!--
                <h4 class="text-secondary">Conditions hostiles et extrêmes</h4>
                <div class="decalage">
                <p>Pour des conditions hostiles, faire <code>!cof-effet conditionsHostiles oui</code> en sélectionnant les personnages concernés. Pour des conditions extrêmes, <code>!cof2-effet conditionsHostiles 5</code>. À noter que le script permet de passer en argument n'importe quel nombre, qui sera appliqué en malus à la DEX, FOR, DEF et attaque.</p>
                </div>
                -->
                <h4 class="text-secondary">Autres bufs et debufs</h4>
                <div class="decalage">
                  <p><code>!cof2-effet <i>effet </i> <i>activation</i></code> : ajoute l'effet <i>effet</i> à la cible. Vous trouverez la liste des effets implémentés dans la <a href=#index_effets>section des effets</a>. Les effets classés en 3 catégories : effets à durée en tour, effets qui durent tout un combat, et effets qui peuvent durer en dehors d'un combat. Pour les effets à durée en tours, <i>activation</i> doit être le nombre de tours (0 met fin à l'effet). Pour les autres effets, <i>activation</i> peut être omis, ou être <code>oui</code>, <code>true</code>, <code>début</code> ou un entier non nul pour l'activer, ou bien <code>fin</code>, <code>false</code>, <code>non</code> ou 0 pour y mettre fin. Si on utilise un nombre pour un de ces effets, il peut être utilisé comme paramètre de l'effet.</p>
                  <p>Un personnage ayant un prédicat nommé <code>immunite_<i>effet</i></code> est immunisé à l'effet de nom <i>effet</i>.</p>
                  <ul>
                    <li><code>--acteur <i>id</i></code> : indique la source de l'effet. Utile pour un certain nombre d'autres options.</li>
                    <li><code>--mana <i>id cout</i></code> : impose au token <i>id</i> de dépenser <i>cout</i> mana. Si <code>--lanceur</code> est donné, <i>id</i> est inutile. La présence de cette option, même avec un coût de 0, indique au script que l'effet devrait être supprimé à la mort du lanceur.</li>
                    <li><code>--limiteParJour <i>l</i></code> : limite le nombre d'utilisations de cette effet à <i>l</i> fois par jour. On peut préciser un nom après <i>l</i>, qui va correspondre à une ressource pouvant être partagée avec d'autres attaques ou d'autres effets (voir <code>!cof-attack</code>). Par défaut, le nom de cette ressource est <i>effet</i>. Attention, il faut un lanceur auquel appliquer la limite par jour !</li>
                    <li><code>--limiteParCombat</code> : même effet que la limite par jour. Si aucun argument n'est donné, la limite est de une fois par combat.  Attention, il faut un lanceur auquel appliquer la limite par combat !</li>
                    <li><code>--tempsRecharge <i>effet</i> <i>duree</i></code> : l'action n'est possible que si l'effet est inactif sur le personnage qui génère l'effet, et de plus active l'effet sur celui-ci pour la durée indiquée. Il existe un effet temporaire générique, <code>rechargeGen(<i>desc</i>)</code> que vous pouvez utiliser si aucun effet existant ne correspond.</li>
                    <li><code>--recharger <i>action</i></code> : indique que l'attaque ne peut être répétée qu'après avoir consacré une action de type <i>action</i> à recharger l'arme.</li>
                    <li><code>--dose <i>nom</i></code>: définie une ressource nommée <code>dose_<i>nom</i></code>, dont la valeur doit être positive. Utile par exemple pour les parchemins, les potions ou les baguettes.</li>
                    <li><code>--depensePR</code>: demande de dépenser un point de récupération. Si un premier argument est ajouté, on enlève ce nombre aux PR au lieu de 1. Si un second argument est précisé, on enlève ce second argument aux PV quand le personnage n'a plus de PR.</li>
                    <li><code>--portee <i>id d</i></code> : impose aux cibles de l'effet d'être à moins de <i>d</i> mètres du token <i>id</i>. Si <code>--lanceur</code> est précisé, inutile de donner <i>id</i>.</li>
                    <li><code>--saveParTour <i>carac seuil</i></code> : la cible peut se sortir de l'effet chaque tour grâce à un test de <i>carac</i> de difficulte <i>seuil</i>.</li>
                    <li><code>--saveActifParTour <i>carac seuil</i></code> : la cible peut se sortir de l'effet à tour grâce à un test de <i>carac</i> de difficulte <i>seuil</i> (utilisation dans bouton dans la liste d'actions).</li>
                    <li><code>--save <i>carac seuil</i></code> : la cible peut faire un jet pour échapper à l'effet. Si on ajoute l'argument <code>demiDuree</code>, alors réussir la sauvegarde ne fait que diviser la durée.</li>
                    <li><code>--seulementVivant</code> : l'effet ne peut s'appliquer qu'aux personnages vivants.</li>
                    <li><code>--dureeEnMinutes <i>duree</i></code> : indique une durée en minute pour les effets qui durent plus d'un combat</li>
                    <li><code>--accumuleDuree <i>n</i></code> : l'effet peut être accumulé : chaque fois qu'on applique à nouveau l'effet avec une durée donnée, on ajoute cette durée à la durée courante de l'effet sur la cible. On ne peut cumuler ainsi que <i>n</i> instances de l'effet.</li>
                    <li><code>--valeur <i>n</i></code> : pour certains effet, permet de spécifier une valeur qui remplace la valeur par défaut de l'effet.</li>
                    <li><code>--optionEffet <i>opt arg1 arg2 ...</i></code> : spécifie une option à l'effet. L'option <i>opt</i> doit être donnée sans le <code>--</code> et sera passée telle quelle à l'effet, par exemple pour les dégâts périodiques. Si on a besoin de plusieurs options, il faut utiliser plusieurs fois <code>--optionEffet</code>.</li>
                    <li><code>--secret</code> : le résultat de l'effet est chuchoté au joueur qui lance la commande.</li>
                    <li><code>--fx <i>effet</i></code> : affiche l'effet spécial entre le lanceur et ses cibles. Il est possible d'utiliser un effet que vous avez défini vous-même en utilisant l'option <code>--fx custom <i>nom</i></code>, où <i>nom</i> est le nom de votre effet.</li>
                    <li><code>--fxCible <i>effet</i></code> : affiche l'effet spécial sur toutes les cibles (l'effet ne doit pas être directionnel).</li> 
                    <li><code>--son <i>son</i></code> : joue le son (normalement compatible avec Roll20AM)</li>
                    <li><code>--image <i>img</i></code> : affiche l'image dans le texte d'activation de l'effet.</li>
                    <li><code>--tokenSide <i>n</i></code> : utilisable seulement pour les tokens à plusieurs faces. Dans ce cas, va changer la face du token en <i>n</i> (à noter que les faces sont numérotées à partir de 0). Quand l'effet se termine, le token retrouve la face qu'il avait au moment où on avait appliqué l'effet.</li>
                    <li><code>--<i>type</i></code> : il est possible d'associer un type à l'effet. L'utilisation la plus courante est le type <code>poison</code> ou <code>maladie</code>, qui vont permettre de tenir compte des bonus ou immunités contre les effets de ce type.</li>
                    <li><code>--montreActions</code> : affiche les actions du tours de la cible après avoir appliqué l'effet. Utile si les actions du tours dépendent de cet effet, pour afficher une liste à jour.</li>
                    <li><code>--degainer <i>L</i></code> : le lanceur dégaine l'arme de label <i>L</i>.</li>
                  </ul>
                  <p> Il existe un effet temporaire générique sans message, pour avoir des timers associés à des personnages : <code>effetTempGenerique</code>. Vous pouvez décider du message à la création avec l'option <code>--activation</code>, du message de statut avec <code>--actif</code> et du message de fin avec <code>--fin</code>.</p>
                  <p><code>!cof-boire-alcool</code> et <code>!cof-desaouler</code> permettent de faire varier le niveau d'ébriété. Par exemple, pour tester si le niveau d'ébriété augmente après avoir bu un certain nombre de verres, on peut utiliser la macro <code>!cof-boire-alcool --save CON [[10+?{Nombre de verres}]]</code>.
                </div>
                <h4 class="text-secondary">Effets retardés</h4>
                <div class="decalage">
                  <p>On peut utiliser l'effet temporaire générique <code>messageRetarde(<i>nom</i>)</code> pour programmer un message qui sera affiché après un certain nombre de tours. Au bout de ce nombre de tours, le nom est affiché, ainsi que le texte de valeur (avec <code>--valeur</code> si besoin). La syntaxe est <code>!cof-effet-temp messageRetarde(<i>nom</i>) <i>duree</i> --valeur <i>message</i></code>. Si vous avez besoin d'un message qui contienne des espaces, remplacez les espaces par des <code>_</code>.</p>
                  <p>On peut aussi déclencher un effet après un certain nombre de tour avec l'effet temporaire générique <code>effetRetarde(<i>effet</i>)</code>. Après la durée de l'effet retardé, si <i>effet</i> est un état, la cible est mise dans cet état, si c'est un effet temporaire, on lui applique cet effet pour une durée de 1 tour, ou si un argument <code>--valeur</code> a été donné, il sera utilisé comme durée. Enfin si ce n'est ni l'un ni l'autre, un attribut avec le nom <i>effet</i> sera créé, de valeur courante <code>true</code>, ou bien si un argument <code>--valeur</code> a été donné, cette valeur sera utilisée comme valeur courante de l'attribut <i>effet</i>.</p>
                </div>
                <!--
                <h4 class="text-secondary">Prédicats : <code>!cof-set-predicate</code></h4>
                <div class="decalage">
                  <p>Il est possible d'ajouter ou de retirer un <a href=#predicats>prédicat</a> avec la fonction <code>!cof-set-predicate <i>nom</i></code>, optionellement suivi de <code>true</code> ou <code>false</code>.</p>
                </div>
                <h4 class="text-secondary">Autres attributs : <code>!cof-set-attribute</code></h4>
                <div class="decalage">
                  Il est possible de changer ou créer n'importe quel attribut avec la fonction <code>!cof-set-attribute <i>nom</i> <i>val</i></code>. Optionellement, on peut spécifier en troisième argument une valeur maximale de l'attribut (comme dans <code>!cof-set-attribute <i>nom</i> <i>val</i> <i>max</i></code>). Attention, ça peut interragir de façon imprévue avec le script ou la fiche, si on écrit dans un attribut utilisé par la fiche.
                </div>
                -->
              </div>
              <h3 class="text-info" id="sorts">2.5 Sorts</h3>
              <div class="decalage">
                <p>Pour les sorts qui demandent un jet d'attaque, utilisez <code>!cof2-attaque</code>, avec l'option <code>--sortilege</code>. L'options <code>--attaqueMagiqueOpposee</code> permet de faire lancer un jet d'attaque magique au défenseur. Pour les sorts qui appliquent un effet répertorié par le script, utilisez <code>!cof2-effet</code>. Pour les sorts sans support particulier, utilisez <code>!cof2-action</code>. Dans tous les cas, vous pouvez préciser le coût en mana avec <code>--mana</code>, et le type d'action avec <code>--typeAction</code>.</p>
                <!--
                <p><code>!cof-peur <i>difficulté durée</i></code> : effet de peur (nécromant, dragon, etc). Tant que la peur est active, statut screaming. <i>difficulté</i> est la difficulté du jet de SAG.</p>
                <span>Options :</span>
                <ul>
                  <li><code>--resisteAvecForce</code> : on prend le max de FOR et SAG pour résister</li>
                  <li><code>--etourdi</code> : la peur fait fuir ou rend étourdi</li>
                  <li><code>--ralenti</code> : la peur ralenti</li>
                  <li><code>--paralyse</code> : la peur paralyse</li>
                  <li><code>--secoue</code> : la peur ne donne qu'un malus de -2 aux tests. Mais un autre effet de peur de même type fait fuir.</li>
                  <li><code>--effroi</code> : la peur est passive (pas un sort)</li>
                  <li><code>--portee <i>n</i></code> : limite la portée du sort à <i>n</i> metres.</li>
                  <li><code>--lanceur <i>id</i></code> : le lanceur de l'effet de peur (si il y en a un). Nécessaire pour la portée, par exemple.</li>
                  <li><code>--titre <i>message</i></code> : spécifie un titre pour la fenêtre affichant les jets de résistance à la peur.</li>
                  <li><code>--immuniseSiResiste <i>nom</i></code> : la personne qui résiste à cet effet de peur est ensuite immunisé pour la journée aux effets de peur ayant la même option (avec le même <i>nom</i>).</li>
                </ul>
                Noter qu'un prédicat <code>courage</code> permet d'obtenir un bonus (égal à la valeur du prédicat) au jet pour résister à la peur.
                <p><code>!cof-changer-de-forme</code> permet de gérer des changements de forme. Le seul argument nécessaire est le nom de la forme, qui doit corresondre au nom d'une des fiches en jeu. Après le changement, le personnage utilisera les caractéristiques, les attaques, les actions et les prédicats de cette fiche. On peut garder certaines caractéristiques en utilisant l'option <code>--gardeCarac</code>, et garder le meilleur avec <code>--gardeCaracSiMeilleure</code>. L'option <code>--utiliserAttaqueMagique</code> permet d'utiliser l'attaque magique du personnage si elle est plus forte que le score d'attaque de la créature. Une option <code>--augmentePVs</code> augmente les PV de ceux de la nouvelle forme divisés par 10. À noter que les prédicats sont toujours ajoutés, ils ne remplacent pas ceux de la fiche d'origine. Le personnage garde toujours ses PV et PM d'origine.</p>
              -->
              </div>
              <h3 class="text-info" id="deplacements">2.6 Déplacements</h3>
              <div class="decalage">
              <h4 class="text-secondary">Retrouver un personnage</h4>
              <div class="decalage">
                <p>Pour centrer la vue d'un joueur sur un token particulier, on peut utiliser <code>!cof2-centrer-sur-token</code> suivi du nom du token.</p>
              </div>
              <h4 class="text-secondary">Personnages immobilisés</h4>
              <div class="decalage">
                <p>Le script bloque automatiquement personnages immobilisés (paralysé, étourdi, etc...). Pour permettre de déplacer ces personnages vous pouvez simplement enlever le blockage (click droit sur le token, propriétés avancées). Si vous souhaitez être le seul à pouvoir le bouger, sélectionner le (ou les) token et cliquer sur la macro <code>Bouger</code>. Cela crée un token non bloqué associé au personnage. Bien penser à supprimer ce token après utilisation.</p>
                <p>Il est possible de mettre le jeu en pause (les joueurs ne peuvent plus bouger leurs tokens) en utilisant la macro &#x23f8;. La macro change alors de nom et devient &#x23f5;, que vous pouvez utiliser pour enlever la pause.</p>
              </div>
              <h4 class="text-secondary" id="escaliers">Escaliers et portails</h4>
              <div class="decalage">
                <p>Pour gérer les escaliers sur les cartes, vous pouvez utiliser la méthode suivante, inspirée du script Teleport : placez dans le layer "GM Info Overlay", au niveau des escaliers, des tokens qui prennent exactement la place des escaliers. Nommez ces escaliers avec un nom, suivi d'une lettre majuscule. Par exemple <code>EscalierA</code>.</p>
                <p>Chaque escalier de la même colonne doit avoir le même nom, et différer seulement par la lettre finale. Ensuite, si un ensemble de tokens est sur un escalier, utilisez <code>!cof2-escalier</code> pour téléporter les tokens à l'emplacement de l'escalier suivant dans l'ordre des lettres. Si vous utilisez l'argument <code>haut</code>, alors les tokens n'iront pas plus loin que le dernier étage, et avec l'argument <code>bas</code>, il iront dans l'ordre inverse.</p>
                <p>Dans l'exemple précédent, il serait téléporté à l'emplacement du token nommé <code>EscalierB</code>. Cela ne fonctionne que si les bouts de l'escalier sont sur la même carte. À vous de choisir sir vous préférez révéler cette fonctionalité à vos joueurs, ou si vous le faites vous-même.</p>
                <p>La limite au nombre d'escaliers est de 12 étages, donc pas de lettre après <code>L</code>.</p>
                <p>Il est possible d'avoir des escaliers qui mènent à d'autres cartes (ce qui fait alors changer la carte vue par le joueur). Il suffit que le nom de l'escalier commence par <code>tmap_</code>. Attention, à cause de limitations de Roll20, cela ne peut fonctionner que si l'image du token est dans une library personnelle d'un joueur : si elle vient du marketplace, il faut d'abord la copier dans sa library, puis utiliser l'image qui est dans la library pour le token.</p>
                <p>Pour des escaliers plus flexibles (voire des portails), on peut décrire dans le champ des <code>Notes du MJ</code> du token sur la couche MJ une destination quand on monte et une destination quand on descend. Il suffit de mettre sur une ligne, <code>descend:</code> directement suivi du nom du token vers lequel aller pour descendre, et/ou sur une autre ligne <code>monte:</code> suivi du nom du token vers lequel aller quand on monte. Par exemple, pour bloquer un escalier qui descend, il suffit de mettre <code>descend:</code> dans le champ de notes du MJ. On peut aussi faire des "escaliers" à sens unique.</p>
                <!--
                <p>Il est possible d'automatiser les escaliers, de façons à ce que les tokens qui passent sur le lieux de l'escalier soient automatiquement transportés. Pour cela, sélectionner le token de l'escalier et lancer la commande <code>!cof-tp-auto</code>. Dans sa version sans argument, le dépacement automatique aura lieu dès qu'un token sera dans le rectangle du token de l'escalier. Sinon, on peut préciser un rayon (en mètres), et le mouvement aura lieur dès que le token sera à moins de cette distance du centre de l'escalier. Le déplacement se fera vers le haut si c'est possible, et sinon vers le bas. À noter que Roll20 peut perdre parfois les données sur les tokens entre les parties. Quand c'est le cas, le script va s'efforce de rerouver les escaliers automatiques, mais ça a plus de chances de marcher si vous donnez un nom unique au token de votre escalier. Pour mettre fin au déplacement automatique sur un escalier, sélectionner le token de l'escalier et taper la commande <code>!cof-tp-auto off</code>.</p>
                -->
              </div>
              <!--
              <h4 class="text-secondary" id="montures">Montures</h4>
              <div class="decalage">
                <p>Pour qu'un personnage puisse monter sur une monture, il faut que cette monture soit associée à une fiche de personnage et qu'il possède un <a href=#predicats>prédicat</a> <code>monture</code>. La commande pour monter sur la monture est <code>!cof-en-selle @{selected|token_id} @{target|token_id}</code>, à lancer en sélectionnant le cavalier.</p>
                <p>On peut ensuite bouger la monture, cela déplace le cavalier. Le mieux est de lancer la commander alors que le token du cavalier est sur le token de la monture. Si on déplace le cavalier, cela fait aussi bouger sa monture.</p>
              </div>
              -->
              <h4 class="text-secondary" id="suivre">Suivre un autre personnages</h4>
              <div class="decalage">
                Le principe est le suivant : on sélectionne un token, dans les abilities qui s'affichent en haut de la map, on clique sur <code>Suivre</code>, puis on sélectionne le token à suivre. À partir de ce moment, le script déplace le premier token à chaque fois qu'on déplace le second (en tenant compte des états qui empêchent le mouvement et des obstacles sur le layer de lumière, si ils doivent empêcher le mouvement). On peut aussi suivre un token qui en suit un autre. Et pour arrêter de suivre un token, il suffit de déplacer manuellement le premier token.

                Ça permet donc d'avoir un familier qui suit un personnage, ou bien de faire automatiquement bouger un groupe de personnage dont l'ordre de marche est déterminé.
              </div>
              <!--
              <h4 class="text-secondary" id="multi-cartes">Déplacer un personnage sur plusieurs cartes</h4>
              <div class="decalage">
                <p>Il est possible de synchroniser des tokens de même nom (représentant le même personnage) sur plusieurs cartes. Ainsi, déplacer le token sur une carte déplace aussi les token sur les autres cartes. Cela peut servir par exemple si tous les joueurs ne doivent pas voir la même chose sur une carte : chaque joueur est alors sur la carte qui lui montre ce qu'il doit voir, et tous les tokens des joueurs sont synchronisés entre les cartes.</p>
                <p>La commande pour activer la synchonisation d'un (ou plusieurs) tokens séléctionnés est <code>!cof-multi-cartes</code>. Pour mettre fin à la synchronisation, on peut sélectionner ces tokens et faire <code>!cof-multi-cartes false</code>. Enfin, cette même commande sans selectionner aucun token met fin à toutes les synchronisations.</p>
              </div>
              -->
              </div>
              <h3 class="text-info" id="lumiere">2.7 Lumière</h3>
              <div class="decalage">
                <p>Pour faire de la lumière, on peut utiliser <code>!cof2-lumiere <i>token_id portee</i></code>. Cela va faire en sorte que le token fasse de la lumière jusqu'à <i>portee</i> mètres. Il est possible d'avoir plusieurs sources de lumière, et la commande est compatible avec la <a href='#Vision_dans_le_noir'>vision dans le noir</a>. La commande admet un troisième argument qui est la distance à laquelle la lumière devient moins brillante, et un quatrième argument qui est le nom du type de lumière (par défaut, <code>lumiere</code>), utilisé quand on éteint les lumières.</p>
                <!--
                <p>Pour les torches, le script propose d'automatiser la gestion en utilisant la commande <code>!cof-torche <i>token_id</i></code>. Si le token tient une torche allumée, cela éteint la torche (et propose au MJ d'indiquer combien de temps la torche est restée allumée), et sinon, si le token possède des torches, cela allume une torche. Le nombre de torche et leur état est stocké dans un attribut <code>torches</code>, dont la valeur courante contient le nombre de torches dans l'inventaire, et la valeur max le temps restant pour la torche en cours d'utilisation (60 minutes pour une torche neuve). Si aucun attribut de ce nom n'existe, le script se contente d'allumer ou d'éteindre une torche, sans gérer leur nombre.</p>
                <p>Pour les armes qui font de la lumière, on peut préciser un prédicat <code>eclaire</code> dans le champ de prédicats de l'arme. La valeur du prédicat doit être la distance à laquelle l'arme éclaire. On peut préciser dans un prédicat <code>eclaireFaible</code> (toujours dans le champ de l'arme) le début de la lumière faible, si besoin. Ça peut aussi être une façon de gérer les torches.</p>
                <p>Quand les personnages sont dans le brouillard, je mets la carte sans lumière, et je sélectionne les tokens et lance la commande <code>!cof-vision-nocturne 6</code> pour qu'ils voient à 6 m.</p>
              -->
              </div>
              <h3 class="text-info" id="anonymat">2.8 Anonymat et fausses identités</h3>
              <div class="decalage">
              <!--
                <p>La fiche de personnage propose deux noms par personnage : le nom principal (appelé simplement "nom") et un alias. Le nom principal est celui visible dans la liste des personnages de l'interface Roll20. C'est aussi celui qui est montré quand on montre une fiche aux joueurs. La fiche propose de choisir le nom affiché lors des jets (champ "connu") : soit le nom principal, soit l'alias. Le script part toujours de l'hypothèse que c'est ce nom qui est connu des joueurs, et que le second est le "vrai" nom. Je laisse le choix au MJ de décider lequel est quoi, car les deux méthodes ont leurs avantages et leurs inconvénients : si on choisit d'avoir l'alias en nom caché, on peut montrer la fiche aux joueurs, sans dévoiler le vrai nom. En revanche, dans la liste des personnages, il peut être plus difficile de s'y retrouver, car le MJ ne verra pas le vrai nom. Si on choisit d'avoir le vrai nom caché, tout est bien clair pour le MJ, mais il doit faire attention à ne pas montrer la fiche aux joueurs.</p>
                <p>Concernant les tokens, le script suppose que vous mettez en "connu" le nom visible par les joueurs.</p>
                <h4 class="text-secondary" id="reveler">Révéler le vrai nom d'un personnage</h4>
                <div class="decalage">
                  <p>Pour révéler le vrai nom d'un personnage au joueurs, vous pourrez utiliser <code>!cof-reveler-nom</code>. L'effet s'applique à tous les personnages sélectionnés (voir les méthodes de sélection). L'effet est le suivant&nbsp;:</p>
                  <ul>
                    <li>Si le personnage était connu par son nom, et que l'alias était non vide, alors on copie l'alias à la place du nom, et on efface l'alias.</li>
                    <li>Si le personnage était connu par son alias, alors on le passe en connu par son nom et on efface l'alias.</li>
                    <li>Si on a fait un des deux changements ci-dessus, alors on change aussi les noms des tokens&nbsp;: si on a passé un nom en argument à <code>!cof-reveler-nom</code>, alors on utilise ce nom. Sinon, on utilise le nouveau nom public. Tous les tokens liés prennent ce nom, et tous les tokens non liés gardent leur numéro et changent juste la partie avant le numéro en ce nom. On n'applique cette transformation qu'aux tokens dont les noms n'ont pas été modifiés (par rapport au token par défaut défini sur la fiche).</li>
                    <li>Et on change aussi le nom du token par défaut.</li>
                  </ul>
                </div>
              -->
              </div>
              <h3 class="text-info" id="autre">2.9 Autres aspects du jeu</h3>
              <div class="decalage">
              <h4 class="text-info" id="annulation">Annuler une action : <code>!cof2-undo</code></h4>
              <div class="decalage">
                <p>Fait partie des fonctions que je met en macro dans la barre du MJ, ça peut servir très souvent. Elle est d'ailleurs générée par la commande <code>!cof2-set-macros</code>.</p>
              </div>
              <h4 class="text-info" id="chance">Chance</h4>
              <div class="decalage">
                <p>Le script essaie de détecter les cas où un point de chance peut être utile, et dans ce cas fournit un bouton (utilisable par les joueurs contrôlant le personnage ou le GM), permettant de dépenser un point de chance. Attention, pour l'instant, il n'est pas possible de faire juste un undo de la dépense de point de chance. Le undo après la dépense de point de chance annule toute l'action. Il faut ensuite faire un undo par point de chance dépensé.</p>
              </div>
              <h4 class="text-info" id="surprise">Surprise : <code>!cof2-surprise ?difficulte</code></h4>
              <div class="decalage">
                <p>Fait un test de surprise sur tous les tokens sélectionné. Si la difficulté n'est pas présente, ils sont automatiquement surpris. Les valeurs des compétences <code>vigilance</code> et <code>perception</code> sont ajoutés au test de perception.</p>
                <p>Si vous souhaitez préciser que la surprise est le fait d'un personnage ou effet non vivant, vous pouvez rajouter l'option <code>--nonVivant</code>.</p>
              </div>
              <!--
              <h4 class="text-info" id="bourse">Gestion de la bourse : <code>!cof-bourse</code></h4>
              <div class="decalage">
                <p>La gestion de la bourse peut se faire sans ouvrir la fiche à l'aide de la commande <code>!cof-bourse</code>. Si un seul token est sélectionné (quelle que soit la méthode de sélection), la commande affiche le montant de la bourse, avec la possibilité de modifier directement les nombres de pièces ou de dépenser ou gagner un certain nombre de pièces.</p>
                <p><code>!cof-bourse depenser <i>n</i></code> permet de faire dépenser de l'argent aux tokens sélectionnés. On peut préciser le type de pièces (pc, pa, po ou pp) après le montant, par défaut le script utilise les pièces d'argent. De même, on peut utiliser <code>!cof-bourse gagner <i>n</i></code> pour ajouter de l'argent.</p>
              </div>
              -->
              <h4 class="text-info" id="son">Jouer un son</h4>
              <div class="decalage">
                <p>Les fonctions d'attaque peuvent jouer un son (options commençant par <code>--soundAttack</code>). Une partie des actions admet aussi une option <code>--son</code> pour jouer un son. Finalement, il est aussi possible de simplement jouer un son en utilisant <code>!cof2-jouer-son <i>son</i></code>. Il est possible d'arrêter tous les sons avec la commande <code>!cof2-jouer-son</code>, sans argument.</p>

                <p>Le script est compatible avec <a href="https://wiki.roll20.net/Script:Roll20_Audio_Master">Roll20AM</a>, et si ce script est installé, il fera appel à lui. Mais si il n'est pas installé (et seulement dans ce cas !), il va simplement utiliser les sons dans le jukebox.</p>
              </div>
              <h4 class="text-info">Changer la taille d'une page : <code>!cof2-agrandir-page</code></h4>
              <div class="decalage">
                <p>
                <code>!cof2-agrandir-carte <i>coef</i></code> permet de multiplier par <i>coef</i> les dimensions de tout ce qui se trouve sur la carte et le layer de la lumière. Les tokens sont déplacés pour se retrouver à la même position relative sur la carte. Je l'utilise pour les cartes que je trouve trop petites pour des groupes de 5-6 joueurs.
                </p>
              </div>
              <h4 class="text-info">Réinitialiser une partie : <code>!cof2-reinit-partie</code></h4>
              <div class="decalage">
                <p>
                C'est principalement utile pour réutiliser une partie qui a déjà été utilisée avec d'autres joueur. La commande va cacher tous les handouts et personnages aux joueurs, remettre les PV des personnages, et enlever leurs états comme assomé ou mort.
                </p>
              </div>
              <h4 class="text-info">Conversion depuis COF1 : <code>!cof2-depuis-cof1</code></h4>
              <div class="decalage">
                <p>
                Peut être utilisé avec toutes les méthodes de sélection, comme par exempple <code>toutLejeu</code> pour tout traduire.
                </p>
              </div>
              <!--
              <h4 class="text-info">Retarder l'affichage de la mort</h4>
              <div class="decalage">
                <p>Pour retarder l'affichage de la mort d'un personnage, ajoutez à ce personnage un <a href=#predicats>prédicat</a> <code>mortDemandeConfirmation</code>. Ainsi, si le personnage meurt à la suite d'une attaque, les PVs finaux ne seront pas enlevés, et la croix rouge indiquant la mort ne sera pas dessinée. À la place, le MJ verra au bout de 2 secondes un bouton lui-demandant de confirmer la mort (par exemple le temps de décrire comment la mort advient).</p>
              </div>
              -->
              </div>
              <h2 class="text-primary" id="peuples">3. Voies de peuples</h2>
              <p>Le script reconnaît les capacités de peuple, qui doivent être dans la première voie de la fiche. Dans certains cas, il faut préciser un paramètre de la capacité. Ci-dessous, une liste des capacités actuellement implémentées, et pour certaines d'entre elles, ce que le joueur ou le MJ doit encore faire à la main. Attention, pour la prise en compte automatique d'une capacité, le mieux est de copier-coller son nom depuis le pdf du livre de règles, ou mieux encore d'utiliser la fonction d'import de la fiche.</p>
              <h3 class="text-info" id="demi-elfe">Demi-elfe</h3>
              <div class="decalage">
                Aucun support pour l'instant.
              </div>
              <h3 class="text-info" id="demi-orc">Demi-orc</h3>
              <div class="decalage">
                <ol>
                  <li><strong>Intimidation :</strong> il y a une compétence de peuple <code>intimidation</code>. La vision dans le noir est automatiquement gérée.</li>
                </ol>
              </div>
              <h3 class="text-info" id="elfe-haut">Elfe haut</h3>
              <div class="decalage">
                <ol>
                  <li><strong>Lumière intérieure :</strong> il y a une compétence de peuple <code>elfeHaut</code>. La partie vision comme de la pénombre sous un ciel étoilé doit être géré à la main par le MJ.</li>
                </ol>
              </div>
              <h3 class="text-info" id="elfe-sylvain">Elfe sylvain</h3>
              <div class="decalage">
                <ol>
                  <li><strong>Lumière des étoiles :</strong> il y a une compétence de peuple <code>elfeSylvain</code>. La partie vision comme de la pénombre sous un ciel étoilé doit être géré à la main par le MJ.</li>
                </ol>
              </div>
              <h3 class="text-info" id="gnome">Gnome</h3>
              <div class="decalage">
                <ol>
                <li><strong>Don étrange :</strong> il y a une compétence de peuple <code>science</code>. La vision dans le noir est automatiquement gérée par le script, et pour le sort, il faut préciser le nom de la capacité du sort dans le champ paramètre (accessible en cliquant sur ).</li>
                </ol>
              </div>
              <h3 class="text-info" id="halfelin">Halfelin</h3>
              <div class="decalage">
                <ol>
                  <li><strong>Petite taille :</strong> il y a une compétence de peuple <code>petiteTaille</code>, et le script ajoute automatiquement un buff de DEF sur la fiche. En revanche, rien n'est fait pour vérifier si les armes son t utilisables, il faut que le MJ soit vigilant.</li>
                </ol>
              </div>
              <h3 class="text-info" id="humain">Humain</h3>
              <div class="decalage">
                <ol>
                  <li><strong>Diversité :</strong> le script rajoute un buff de points de chance sur la fiche, et l'origine peut être précisée en paramètre. Si c'est une des 6 origines proposées dans le livre on peut juste mettre le nom de l'origine (<code>montagnard</code>, etc.), sinon il faut mettre une description des champs d'application du bonus.</li>
                </ol>
              </div>
              <h3 class="text-info" id="nain">Nain</h3>
              <div class="decalage">
                <ol>
                <li><strong>Habitant des tunnels :</strong> il y a une compétence de peuple <code>nain</code>. La vision dans le noir est automatiquement gérée.</li>
                </ol>
              </div>
              <h3 class="text-info" id="mage">Mage</h3>
              <div class="decalage">
                <ol>
                <li><strong>Capacité de peuple + occultisme :</strong> il y a une compétence évolutive <code>occultisme</code>. La capacité de peuple est inférée à partir du nom du peuple du personnage. Si cette capacité a besoin d'un paramètre, utiliser le paramètre de la capacité de mage.</li>
                </ol>
              </div>
              <h2 class="text-primary" id="profils">4. Voies de profils</h2>
              <h3 class="text-info" id="arquebusier">Arquebusier</h3>
              <div class="decalage">
                <h4 class="text-secondary">Voie de l'artilleur</h4>
                <ol>
                  <li><strong>Mécanismes :</strong> il y a une compétence évolutive nommée <code>mecanismes</code>. le reste n'est pas encore implémenté.</li>
                </ol>
              </div>
                <h3 class="text-info" id="barbare">Barbare</h3>
              <div class="decalage">
              </div>
                <h3 class="text-info" id="barde">Barde</h3>
              <div class="decalage">
              </div>
                <h3 class="text-info" id="chevalier">Chevalier</h3>
              <div class="decalage">
              </div>
                <h3 class="text-info" id="druide">Druide</h3>
              <div class="decalage">
                <h4 class="text-secondary">Voie des végétaux</h4>
                <ol>
                  <li><strong>Peau d’écorce :</strong> il y a une compétence évolutive nommée <code>plantes</code>. Le script fait apparaître le sort dans la liste d'actions du druide.</li>
                </ol>
              </div>
                <h3 class="text-info" id="ensorceleur">Ensorceleur</h3>
              <div class="decalage">
                <h4 class="text-secondary">Voie de l'envouteur</h4>
                <ol>
                  <li><strong>Injonction :</strong> il y a une compétence évolutive nommée <code>injonction</code>. Le script ajoute aussi automatiquement le sort à lancer dans la liste des actions du tour (pas sur la fiche).</li>
                </ol>
              </div>
                <h3 class="text-info" id="forgesort">Forgesort</h3>
              <div class="decalage">
              </div>
                <h3 class="text-info" id="guerrier">Guerrier</h3>
              <div class="decalage">
                <h4 class="text-secondary">Voie du bouclier</h4>
                <ol>
                  <li><strong>Protéger un allié :</strong> il y a une compétence évolutive appelée <code>vigilance</code>. Le reste est aussi géré par le script.</li>
                </ol>
                <h4 class="text-secondary">Voie de la résistance</h4>
                <ol>
                  <li><strong>Robustesse :</strong> il y a une compétence évolutive appelée <code>robustesse</code>. Le script ajoute aussi un buff sur la fiche pour les PV. Pour que tout ce passe bien, pensez à activer le calcul automatique des PV max sur la fiche.</li>
                </ol>
              </div>
                <h3 class="text-info" id="magicien">Magicien</h3>
              <div class="decalage">
                <h4 class="text-secondary">Voie de la magie destructrice</h4>
                <ol>
                  <li><strong>Arc de feu :</strong> le sort apparaît automatiquement dans les actions du tour.</li>
                </ol>
                <h4 class="text-secondary">Voie de la magie universelle</h4>
                <ol>
                  <li><strong>Lumière :</strong> le sort apparaît automatiquement dans les actions du tour.</li>
                  <li><strong>Familier :</strong> il faut indiquer en paramètre de la capacité le nom du familier. Le script crée alors automatiquement le personnage du familier. Le joueur ou le MJ doivent quand même lui ajouter un token, avec les PV liés au personnage. Le script gère automatiquement les bonus associés.</li>
                </ol>
              </div>
                <h3 class="text-info" id="moine">Moine</h3>
              <div class="decalage">
              </div>
                <h3 class="text-info" id="pretre">Prêtre</h3>
              <div class="decalage">
                <h4 class="text-secondary">Voie de la prière</h4>
                <ol>
                  <li><strong>Bénédiction :</strong> il y a une compétence évolutive nommée <code>theologie</code>. Le script fait apparaître le sort dans la liste des actions du tour.</li>
                </ol>
                <h4 class="text-secondary">Voie des soins</h4>
                <ol>
                  <li><strong>Récupération mineure :</strong> il y a  une compétence évolutive nommée <code>medecine</code>. Le sort apparaît dans la liste d'actions, si la limite du nombre de lancements journaliers n'est pas atteinte.</li>
                </ol>
              </div>
                <h3 class="text-info" id="rodeur">Rôdeur</h3>
              <div class="decalage">
                <h4 class="text-secondary">Voie de l'archer</h4>
                <ol>
                  <li><strong>Archer émérite :</strong> ajoute automatiquement le buff d'initiative sur la fiche, ainsi que les dommages aux dégâts des arcs. Attention, il faut bien penser à ajouter <code>arc</code> dans la partie modificateurs de l'attaque, si un arc ne contient pas le mot <code>arc</code> dans son nom.</li>
                  <li><strong>Tir chirurgical :</strong> pris en compte.</li>
                </ol>
                <h4 class="text-secondary">Voie du compagnon animal</h4>
                <ol>
                  <li><strong>Le loup :</strong> il faut indiquer le nom du loupdans les paramètres de la capacité. Le script va ensuite automatiquement créer la fiche et le token du loup.</li>
                  <li><strong>Travail d'équipe :</strong> le script ajoute le prédicat <code>travailDEquipe</code>, qui permet d'avoir les dé bonus appropriés.</li>
                </ol>
              </div>
                <h3 class="text-info" id="sorcier">Sorcier</h3>
              <div class="decalage">
              </div>
                <h3 class="text-info" id="voleur">Voleur</h3>
              <div class="decalage">
              </div>
              <h2 class="text-primary" id="prestige">5. Voies de prestige</h2>
              <h2 class="text-primary" id="autres_capacites">6. Autres capacités</h2>
              <h2 class="text-primary" id="Markers_personnalisés">7. Markers Personnalisés</h2>
              <h3 class="text-info" id="Markers_presentation">7.1 Présentation</h3>
              <div class="decalage">
                <p>Roll20 peut être déroutant lors des premières utilisations pour des joueurs plus habitués au Jeu de Rôle sur table. Il introduit des notions peu courantes du fait que les combats vont se dérouler sur des "battlemaps" quadrillées ou non. Aussi on va prendre quelques minutes pour expliquer deux notions importantes : <strong>les tokens</strong> et <strong>les tokens markers</strong> (plus simplement appelés <strong>markers</strong> par la suite).</p>
                <p>Le token : Un token est la représentation graphique d'un personnage (PJ ou PNJ) sur la battlemap. Grâce au token on sait à tout moment où se trouve le personnage, s'il subit un sort à effet de zone ou si sa ligne de tir est dégagée par exemple.</p>
                <p>Le marker : Un marker est forcément attaché à un token. Il représente un "état" qui affecte le personnage (<a href="#etats">liste des états</a>). Il se matérialise par une icône dans le coin en haut à doite du token. Un token peut afficher plusieurs markers au même moment. Ils représentent plusieurs états qui se cumulent pour ce personnage.
                <p><img class="img-fluid" src="https://imgur.com/7aLlEL3.png" data-href="https://imgur.com/7aLlEL3.png"></p>
                <p>Dans l'image ci-dessus le token c'est le personnage à la cape bleue qui représente un PJ et le marker c'est le petit escargot qui signifie que ce même PJ est "ralenti". Le script gère les états des PJ et PNJ et il matérialisera leurs états grâce aux markers. Par exemple le MJ va demande un jet de surprise, le script effectue les jets de dés nécessaire et matérialise l'état "surpris" grâce à un marker pour les personnages qui ont raté leur jet de dé. Le script applique automatiquement le malus -5 à la DEF. Au bout d'un tour l'état "surpris" et le marker seront retirés automatiquement par le script. Le MJ peut aussi mettre directement un état à un personnage. Par exemple s'il considère que ses PJs voyagent trop chargés il peut ajouter le marker "encombré" qui lui rappelera que dorénavant les jets de DEX se font sur un d12 et plus sur un d20.</p>
                <p>Il existe des markers qui ne représentent pas un état mais ils sont rares. On peut souligner les ronds de couleurs qui permmettent au joueur de retrouver son token plus facilement. De la même manière dans les markers cof il y existent deux marqueurs <code>cof-init...</code> qui permettent de repérer le prochain joueur pendant les combats. Ce n'est pas un état.</p>
              </div>
              <h3 class="text-info" id="Markers_COF">7.2 Récupération des markers dédiés COF</h3>
              <div class="decalage">
                <p>Roll20 possède des markers par défaut mais ils ne sont pas toujours adaptés pour Chroniques Oubliées Fantasy. La communauté a voté pour choisir les tokens les plus pertinents dans le contexte COF. Voici le <a href="https://www.black-book-editions.fr/forums.php?topic_id=16514">lien vers le post dans le forum BBE</a>. N'hésitez pas à venir poser vos questions ou proposer vos talents de graphiste à la communauté.</p>
                <p>Avant de pouvoir créer votre propre jeu de markers sur Roll20, vous devez préalablement télécharger ceux mis à disposition par la communauté depuis <a href="https://github.com/Ulty/COFantasy">le repository GitHub du projet</a>. Procédez comme suit :</p>
                <p><img class="img-fluid" src="https://imgur.com/xEUDHaC.png" data-href="https://imgur.com/xEUDHaC.png"></p>
                <p>Une fois le fichier téléchargé sur votre PC dézippez le répertoire <code>cof-marker-set</code> et son sous-répertoire</p>
              </div>
              <h3 class="text-info" id="Markers_Import">7.3 Importation des markers dans Roll20</h3>
              <div class="decalage">
                <p>Dans le répertoire <code>cof-marker-set</code> vous trouverez tous les markers qui ont été choisis par la communauté. Dans le répertoire <code>markers-alternatifs</code> vous trouverez les glorieux seconds au vote que vous pouvez utiliser en lieu et place du marker choisi s'il vous plaît plus. Il vous suffit alors de glisser-déposer le fichier dans le répertoire principal et de confirmer l'écrasement de l'autre marker. Vous pouvez aussi choisir vos propres markers dans  <a href="https://game-icons.net/">cette géniale bibliothéque d'icônes</a>. Vous pouvez aussi déssiner vos propre marker. Les limites sont que la taille de l'image doit être exactement de 512x512 px. Un fichier PNG est préférable pour gérer la transparence. Enfin votre fichier doit porter exactement le même nom qu'indiqué <a href="#etats">dans cette documentation</a>.</p>
                <p>Dans Roll20 rendez-vous dans le menu "Outils" puis "Token Marker Library". Appuyez sur "Create Set". Puis renseignez le nom du marker set. "cof markers" par exemple. Appuyez sur "Create Set".</p>
                <p><img class="img-fluid" src="https://imgur.com/NrHZ5Q6.png" data-href="https://imgur.com/NrHZ5Q6.png"></p>
                <p>Vous arrivez alors sur la fenêtre suivante où il suffit de déposer les fichiers pour qu'ils soient uploadés sur Roll20</p>
                <p><img class="img-fluid" src="https://imgur.com/5TUTgWb.png" data-href="https://imgur.com/5TUTgWb.png"></p>
                <p>A ce moment il y a deux écoles de vie : ceux qui lâchent tous leurs markers en même temps et qui laisse le soin aux serveurs de Roll20 de décider dans quel ordre ils verront apparaître les markers dans leur interface pour le restant de leur jour. Et ceux qui posent les fichiers un par un pour que l'ordre qu'ils souhaitent soit respecté par Roll20. Quand tout est prêt cliquez sur "Upload". Vous avez un message "Fichiers en cours de traitement" pendant 1 à 2 minutes. Ensuite Roll20 vous propose de renommer vos tokens. Ne changez rien et faîtes "Save". Ca y est, vos markers personnalisés sont enfin prêts !</p>
              </div>
              <h3 class="text-info" id="Markers_Check">7.4 Activation et Vérification</h3>
              <div class="decalage">
                <p>Mais ce n'est pas fini il vous faut encore affecter vos markers à votre campagne. Cela se passe sur la page d'acceuil de votre campagne:</p>
                <p><img class="img-fluid" src="https://imgur.com/cE5OAga.png" data-href="https://imgur.com/cE5OAga.png"></p>
                <p>Lancez votre campagne et vérifiez que les nouveaux markers apparaissent bien. Lancez ensuite la commande <code>!cof-options</code> pour cocher "Markers Personnalises". Enfin comme dernier contrôle allez dans la console des API, faîtes "restart API sandbox" et vérifiez que le message "Markers personnalisés activés" est bien présent. Si ce n'est pas le cas vous avez probablement oublié des markers "obligatoires" et le script n'a pas pu activer les markers cof pour cette raison. La liste des markers manquants devrait apparaître dans la console.</p>
              </div>
              <h2 class="text-primary" id="Console">8. Console API</h2>
              <h3 class="text-info" id="Generalites_Console">8.1 Généralités sur la Console </h3>
              <div class="decalage">
                <p>Il est recommandé quand vous jouez de garder un onglet de votre navigateur ouvert sur la Console API de votre campagne (Paramètres -> Scripts API). En cas d'absence de réponse du jeu il vous permet de facilement prendre connaissance d'une éventuelle erreur et de prendre rapidement les actions correctives nécessaires.</p>
                <p>Un message bloquant est écrit dans un bloc rouge en dehors de la fenêtre API Output Console et ressemble à l'image suivante :</p>
                <p><img class="img-fluid" src="https://imgur.com/ydMKYLl.png" data-href="https://imgur.com/ydMKYLl.png"></p>
                <p>Lorsqu'un message rouge comme celui-ci interrompt votre partie vérifiez s'il possède une solution identifiée dans le paragraphe ci-dessous. "Restart API sandbox" permet de relancer le script mais les mêmes causes provoqueront la même erreur. Si le message d'erreur n'est pas encore référencé ou ne propose pas de solution, essayez de comprendre quelle est votre dernière action ou quel bouton provoque cette erreur et terminez votre séance en évitant de l'utiliser. Retestez plus tard et si l'erreur se reproduit expliquez-nous votre problème <a href="https://www.black-book-editions.fr/forums.php?topic_id=7842">sur ce post dans le forum BBE</a>. Essayez d'être le plus exhaustif possible dans vos explications car malheureusement les messages de Roll20 ne sont pas précis du tout quant au contexte de l'erreur. Par exemple le numéro de la ligne de code incriminée ne nous est pas connue et l'on a donc besoin de toutes les précisions possibles pour comprendre le problème et être en capacité de le reproduire afin de le corriger.</p>
                <p>Les messages qui sont à l'interieur de la fenêtre API Output Console sont des messages d'information ou d'alerte comme sur l'image suivante :</p>
                <p><img class="img-fluid" src="https://imgur.com/5N5xrXI.png" data-href="https://imgur.com/5N5xrXI.png"></p>
                <p>Malgré la gravité apparente de certains de ces messages (SyntaxError) ils n'empêchent jamais le bon fonctionnement du script. Seuls les messages bloquants apparaissants en rouge empêche le bon fonctionnement du script. Nous n'avons pas complétement la main sur l'apparition de ces messages d'alerte et nous travaillons activement avec Roll20 pour les éliminer. Des messages d'informations sont aussi présents comme par exemple le numéro de version du script que vous utilisez actuellement.</p>
              </div>
              <h3 class="text-info" id="Messages_Console">8.2 Principaux messages bloquants</h3>
              <div class="decalage">
                <ul>
                  <li><code>There was an error communicating with the QuantumRoll server</code> Erreur Roll20 courante. "Restart API Sandbox" règle normalement ce problème.</li>
                  <li><code>docker: Cannot connect to the Docker daemon. Is the docker daemon running on this host?</code> Erreur Roll20. "Restart API Sandbox" règle normalement ce problème.</li>
                  <li><code>SyntaxError: Invalid or unexpected token ... </code> Erreur dans le code. Pas de solution évidente. Le signaler uniquement si c'est un message bloquant (rouge).</li>
                  <li><code>SyntaxError: Unexpected token ... </code> Erreur dans le code. Pas de solution évidente. Le signaler uniquement si c'est un message bloquant (rouge).</li>
                  <li><code>TypeError: Cannot read property '...' of undefined </code> Erreur dans le code. Pas de solution évidente. Le signaler uniquement si c'est un message bloquant (rouge).</li>
                </ul>
              </div>
              <h3 class="text-info" id="Infos_Console">8.3 Principaux messages d'information et d'alerte</h3>
              <div class="decalage">
                <ul>
                  <li><code>COFantasy2 X.XX loaded</code> Information : Le script a correctement démarré. Vous indique le numéro de version utilisé.</li>
                  <li><code>Markers personnalisés activés</code> Information : Succès de l'activation des <a href="#Markers_personnalisés">Markers Personnalisés</a>.</li>
                  <li><code>API sandbox shutdown due to campaign inactivity</code> Information : "Restart API Sandbox" ou l'utilisation de la campagne remet en route la sandbox.</li>
                  <li><code>Markers personnalisés manquants -> Retour aux markers standards Roll20. Voir erreur(s) ci-dessus.</code> Alerte : Impossibilité d'activer les <a href="#Markers_personnalisés">Markers Personnalisés</a> pour cause d'un marker obligatoire absent.</li>
                  <li><code>Marker cof-XXX introuvable</code> Alerte : Erreur dans le nom d'un marker. Voir <a href="#Markers_personnalisés">Markers Personnalisés</a> ou <a href="#etats">liste des états</a>.</li>
                </ul>
              </div>
              <h3 class="text-info" id="Reset_state">8.4 Purger les variables d'état du jeu</h3>
              <div class="decalage">
                <p>Pour son bon fonctionnement, le script stoque des données, parfois complexes, et il peut arriver que ces données soient corrompues. Dans ce cas, le script peut planter de manière systématique, même sur des actions simples. Si vous soupçonnez une corruption des données, vous pouvez tenter de lancer la commande <code>!cof2-clean-global-state</code>.
                </p>
              </div>
              <h2 class="text-primary" id="index_predicats">9. Index des prédicats</h2>
              <div class="decalage">
                <ul>
                  <li><strong>armesMaitrisees</strong> : rajoute des armes maîtrisées à celles définies par le profil et les voies choisies. On peut indiquer plusieurs fois ce prédicat, et la valeur peut être soit un type d'arme (<code>epee</code>, <code>arc</code>, <code>poudre</code>, etc), soit <code>toutes</code> (pour toutes les armes sauf les armes à poudre), soit <code>contact</code> pour les armes de contact, soit <code>distance</code> pour les armes à distance sauf les armes à poudre, soit <code>uneMain</code> pour les armes à une main, soit <code>contactUneMain</code> pour les armes de contact à une main. Pour les armes contondantes à une main, utiliser <code>contondantUneMain</code>. Pour les arbalètes légères, on peut utiliser <code>arbaleteLegere</code>. Pour les arcs courts, <code>arcCourt</code>.</li>
                  <li><strong>attaqueEnMeute</strong> : ajoute +2 à l'attaque si attaque la même cible qu'un allié.</li>
                  <li><strong>ajoutePERauxDMdArc</strong> : indique qu'il fait ajouter la PER aux dégâts des arcs.</li>
                  <li><strong>aucuneActionCombat</strong> : indique que le personnage n'agit jamais en combat. Ce peut être pas exemple le cas du familier du mage.</li>
                  <li><strong>bonusInitiative</strong> : bonus à l'initiative. Ne se cumule pas.</li>
                  <li><strong>bonusTest_<i>carac</i></strong> : bonus aux tests de caractéristique <i>carac</i>. Ne se cumule pas.</li>
                  <li><strong>bonusTest_<i>competence</i></strong> : bonus aux tests de compétence <i>competence</i>. Ne se cumule pas.</li>
                  <li><strong>bonusTestEvolutif_<i>competence</i></strong> : bonus ou nom de voie. Si on donne un nom de voie, le bonus est le rang dans la voie + 2, capé à 7.</li>
                  <li><strong>bonusTestPeuple_<i>competence</i></strong>: bonus aux tests de compétence <i>competence</i>. La valeur par défaut est 3.</li>
                  <li><strong>bonusTestPrestige_<i>competence</i></strong> : bonus aux tests de compétence <i>competence</i>. La valeur par défaut est 5.</li>
                  <li><strong>descriptionTestEvolutif_<i>nom</i></strong> : description des actions et circonstances correspondant au bonus évolutif nommé <i>nom</i></li>
                  <li><strong>descriptionTestPeuple_<i>nom</i></strong> : description des actions et circonstances correspondant au bonus de peuple nommé <i>nom</i></li>
                  <li><strong>descriptionTestPrestige_<i>nom</i></strong> : description des actions et circonstances correspondant au bonus de voie de prestige nommé <i>nom</i></li>
                  <li><strong>familierMage</strong> : un nom de familier. Quand le familier est visible du personnage, donne un bonus de +2 en initiative et en défense.</li>
                  <li><strong>nomTestEvolutif_<i>nom</i></strong> : le nom à afficher pour bonus évolutif nommé <i>nom</i></li>
                  <li><strong>nomTestPeuple<i>nom</i></strong> : le nom à afficher pour bonus de peuple nommé <i>nom</i></li>
                  <li><strong>nomTestPrestige<i>nom</i></strong> : le nom à afficher pour bonus de voie de prestige nommé <i>nom</i></li>
                  <li><strong>protegerUnallie</strong> : donne la possibilité d'ajouter +2 en DEF à un allié une fois par tour lorsqu'on porte un bouclier.</li>
                  <li><strong>tirIgnoreCibleEngagee</strong>: les attaques à distance igorent les pénalités liées aux cible aux contact avec des alliés.</li>
                  <li><strong>visionDansLeNoir</strong> : entier. Le personnage voit dans le noir jusqu'à cette distance.</li>
                </ul>
              </div>
              <h2 class="text-primary" id="index_effets">10. Index des effets</h2>
              <div class="decalage">
              <h3 class="text-info" id="index_effets_temp">10.1 Effets à durée en tours</h3>
              <div class="decalage">
              </div>
              <h3 class="text-info" id="index_effets_combat">10.2 Effets qui durent un combat</h3>
              <div class="decalage">
              </div>
              <h3 class="text-info" id="index_effets_indetermines">10.1 Effets qui peuvent aussi s'appliquer en dehors des combats</h3>
              <div class="decalage">
                <p>Pour certains effets, on peut passer un paramètre entier non nul au moment de l'activation (<code>!cof2-effet <i>effe</i> <i>parametre</i></code>). C'est dans ce cas indiqué dans la description comme valeur d'activation.
              <ul>
                <li><strong>benediction</strong> : bonus à tous les tests, de valeur l'activation, ou 1 par défaut.</li>
                <li><strong>bonusCouvert</strong> : bonus contre les attaques à distance, de valeur l'activation, ou 2 par défaut.</li>
                <li><strong>peauDEcorce</strong> : bonus en DEF.</li>
              </ul>
              </div>
              </div>
            </div>
          </div>
        </div>
          <p><i>Ce site utilise des marques déposées et des droits d’auteurs qui sont la propriété de Black Book Editions comme l’y autorisent les conditions d’utilisation de Black Book Editions. Ce site n’est pas publié par Black Book Editions et n’a pas reçu son aval ni une quelconque approbation de sa part. Pour de plus amples informations sur Black Book Editions, consultez <a href="www.black-book-editions.fr">www.black-book-editions.fr</a>.</i></p>
        
  </body>
</html>
